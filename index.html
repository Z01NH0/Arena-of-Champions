<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arena of Champions</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background-color: #222;
            color: white;
        }
        
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        #canvas {
            display: block;
            background-color: #111;
        }
        
        #menu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }
        
        #title {
            font-size: 48px;
            margin-bottom: 40px;
            color: #f0f0f0;
            text-shadow: 0 0 10px #fff;
        }
        
        .team-select {
            display: flex;
            gap: 50px;
            margin-bottom: 40px;
        }
        
        .team {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .team-title {
            font-size: 24px;
            margin-bottom: 20px;
        }
        
        .team-red .team-title {
            color: #f00;
        }
        
        .team-blue .team-title {
            color: #00f;
        }
        
        .character-select {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            max-width: 500px;
        }
        
        .character {
            width: 120px;
            height: 160px;
            background-color: #333;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .character:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px #555;
        }
        
        .character.selected {
            box-shadow: 0 0 20px currentColor;
        }
        
        .team-red .character.selected {
            border: 2px solid #f00;
            color: #f00;
        }
        
        .team-blue .character.selected {
            border: 2px solid #00f;
            color: #00f;
        }
        
        .character-icon {
            width: 70px;
            height: 70px;
            background-color: #555;
            border-radius: 50%;
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
        }
        
        .character-name {
            font-size: 16px;
            margin-bottom: 5px;
            text-align: center;
        }
        
        .character-desc {
            font-size: 10px;
            text-align: center;
            color: #aaa;
        }
        
        #startButton {
            padding: 15px 40px;
            font-size: 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        #startButton:hover {
            background-color: #45a049;
            transform: scale(1.05);
        }
        
        #gameUI {
            position: absolute;
            top: 10px;
            left: 0;
            right: 0;
            color: white;
            font-size: 18px;
            z-index: 5;
            display: none;
        }
        
        .health-bar {
            width: 200px;
            height: 20px;
            background-color: #333;
            border: 2px solid #555;
            margin-bottom: 5px;
            position: relative;
        }
        
        .health-fill {
            height: 100%;
            width: 100%;
            background-color: #f00;
            transition: width 0.3s;
        }
        
        .team-red .health-fill {
            background-color: #f00;
        }
        
        .team-blue .health-fill {
            background-color: #00f;
        }
        
        .special-bar {
            width: 200px;
            height: 15px;
            background-color: #333;
            border: 2px solid #555;
            margin-top: 10px;
        }
        
        .special-fill {
            height: 100%;
            width: 0%;
            background-color: #00f;
            transition: width 0.3s;
        }
        
        .basic-attack-bar {
            width: 200px;
            height: 10px;
            background-color: #333;
            border: 2px solid #555;
            margin-top: 5px;
        }
        
        .basic-attack-fill {
            height: 100%;
            width: 0%;
            background-color: #0f0;
            transition: width 0.3s;
        }
        
        .player-info {
            position: absolute;
            top: 10px;
            width: 220px;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 5px;
        }
        
        #player1Info {
            left: 10px;
            border-left: 3px solid #f00;
        }
        
        #player2Info {
            right: 10px;
            border-right: 3px solid #00f;
        }
        
        .player-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        #gameOver {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
        }
        
        #gameOver h1 {
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        #winnerText {
            font-size: 36px;
            margin-bottom: 30px;
        }
        
        #restartButton {
            padding: 15px 40px;
            font-size: 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        #restartButton:hover {
            background-color: #45a049;
            transform: scale(1.05);
        }
        
        #menuButton {
            padding: 15px 40px;
            font-size: 20px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }
        
        #menuButton:hover {
            background-color: #d32f2f;
            transform: scale(1.05);
        }
        
        .instructions {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: #aaa;
            font-size: 14px;
            text-align: center;
            width: 100%;
        }
        
        .controls {
            margin-top: 10px;
            font-size: 12px;
            color: #ccc;
        }
        
        #scoreDisplay {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            color: white;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px 24px;
            border-radius: 5px;
            z-index: 5;
        }
        
        #roundWinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            color: white;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 20px 40px;
            border-radius: 10px;
            z-index: 15;
            display: none;
        }
        
        #victoryScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 25;
        }
        
        #victoryText {
            font-size: 72px;
            margin-bottom: 40px;
            color: gold;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
        }
        
        #victoryButtons {
            display: flex;
            gap: 20px;
        }

       

        .aim-arrow {
            position: absolute;
            width: 15px;
            height: 15px;
            background-color: white;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            transform-origin: 50% 100%;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="canvas"></canvas>
        
        <div id="gameUI">
            <div id="player1Info" class="player-info team-red">
                <div class="player-name">Jogador 1</div>
                <div class="health-bar">
                    <div class="health-fill"></div>
                </div>
                <div class="special-bar">
                    <div class="special-fill"></div>
                </div>
                <div class="basic-attack-bar">
                    <div class="basic-attack-fill"></div>
                </div>
                <div class="controls">WASD - Movimento | T - Atirar | Y - Especial</div>
            </div>
            
            <div id="player2Info" class="player-info team-blue">
                <div class="player-name">Jogador 2</div>
                <div class="health-bar">
                    <div class="health-fill"></div>
                </div>
                <div class="special-bar">
                    <div class="special-fill"></div>
                </div>
                <div class="basic-attack-bar">
                    <div class="basic-attack-fill"></div>
                </div>
                <div class="controls">Setas - Movimento | L - Atirar | √á - Especial</div>
            </div>
            
            <div id="scoreDisplay">Vermelho 0 - 0 Azul</div>
        </div>
        
        <div id="menu">
            <h1 id="title">Arena of Champions</h1>
            
            <div class="team-select">
                <div class="team team-red">
                    <div class="team-title">Time Vermelho (Jogador 1)</div>
                    <div class="character-select">
                        <div class="character" data-character="fireMage">
                            <div class="character-icon">üî•</div>
                            <div class="character-name">Mago de Fogo</div>
                            <div class="character-desc">Atira bolas de fogo que causam queimadura. Especial: Explos√£o de fogo.</div>
                        </div>
                        <div class="character" data-character="archer">
                            <div class="character-icon">üèπ</div>
                            <div class="character-name">Arqueiro Real</div>
                            <div class="character-desc">Atira flechas rapidamente. Especial: Chuva de flechas.</div>
                        </div>
                        <div class="character" data-character="knight">
                            <div class="character-icon">‚öîÔ∏è</div>
                            <div class="character-name">Cavaleiro Negro</div>
                            <div class="character-desc">Atira tr√™s proj√©teis de uma vez. Especial: Espada poderosa.</div>
                        </div>
                        <div class="character" data-character="necromancer">
                            <div class="character-icon">üíÄ</div>
                            <div class="character-name">Necromante</div>
                            <div class="character-desc">Invoca criaturas dos mortos. Especial: Invoca√ß√£o dos Mortos.</div>
                        </div>
                        <div class="character" data-character="lancer">
                            <div class="character-icon">üî±</div>
                            <div class="character-name">Lanceiro</div>
                            <div class="character-desc">Ataques corpo-a-corpo poderosos. Especial: Investida Real.</div>
                        </div>
                        <div class="character" data-character="assassin">
                            <div class="character-icon">üó°Ô∏è</div>
                            <div class="character-name">Assassino</div>
                            <div class="character-desc">Ataques r√°pidos e furtivos. Especial: Desaparecimento Letal.</div>
                        </div>
                    </div>
                </div>
                
                <div class="team team-blue">
                    <div class="team-title">Time Azul (Jogador 2)</div>
                    <div class="character-select">
                        <div class="character" data-character="fireMage">
                            <div class="character-icon">üî•</div>
                            <div class="character-name">Mago de Fogo</div>
                            <div class="character-desc">Atira bolas de fogo que causam queimadura. Especial: Explos√£o de fogo.</div>
                        </div>
                        <div class="character" data-character="archer">
                            <div class="character-icon">üèπ</div>
                            <div class="character-name">Arqueiro Real</div>
                            <div class="character-desc">Atira flechas rapidamente. Especial: Chuva de flechas.</div>
                        </div>
                        <div class="character" data-character="knight">
                            <div class="character-icon">‚öîÔ∏è</div>
                            <div class="character-name">Cavaleiro Negro</div>
                            <div class="character-desc">Atira tr√™s proj√©teis de uma vez. Especial: Espada poderosa.</div>
                        </div>
                        <div class="character" data-character="necromancer">
                            <div class="character-icon">üíÄ</div>
                            <div class="character-name">Necromante</div>
                            <div class="character-desc">Invoca criaturas dos mortos. Especial: Invoca√ß√£o dos Mortos.</div>
                        </div>
                        <div class="character" data-character="lancer">
                            <div class="character-icon">üî±</div>
                            <div class="character-name">Lanceiro</div>
                            <div class="character-desc">Ataques corpo-a-corpo poderosos. Especial: Investida Real.</div>
                        </div>
                        <div class="character" data-character="assassin">
                            <div class="character-icon">üó°Ô∏è</div>
                            <div class="character-name">Assassino</div>
                            <div class="character-desc">Ataques r√°pidos e furtivos. Especial: Desaparecimento Letal.</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <button id="startButton">Come√ßar Batalha</button>
         
        </div>
        
        <div id="gameOver">
            <h1>Fim da Batalha</h1>
            <div id="winnerText"></div>
            <button id="restartButton">Jogar Novamente</button>
        </div>
        
        <div id="roundWinner"></div>
        
        <div id="victoryScreen">
            <div id="victoryText"></div>
            <div id="victoryButtons">
                <button id="rematchButton">Revanche</button>
                <button id="menuButton">Menu</button>
            </div>
        </div>
    </div>

    <script>
        // Configura√ß√µes do jogo
        const config = {
            width: 800,
            height: 600,
            playerSpeed: 5,
            playerSize: 20,
            powerUpSpawnRate: 15000, // 15 segundos
            specialCooldown: {
                fireMage: 15000,
                archer: 15000,
                knight: 20000,
                necromancer: 20000,
                lancer: 17000,
                assassin: 15000
            },
            basicAttackCooldown: {
                fireMage: 700,
                archer: 250,
                knight: 550,
                necromancer: 650,
                lancer: 1000,
                assassin: 300
            }
        };

        // Elementos do DOM
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const menu = document.getElementById('menu');
        const gameUI = document.getElementById('gameUI');
        const player1Info = document.getElementById('player1Info');
        const player2Info = document.getElementById('player2Info');
        const gameOverScreen = document.getElementById('gameOver');
        const winnerText = document.getElementById('winnerText');
        const startButton = document.getElementById('startButton');
        const restartButton = document.getElementById('restartButton');
        const characterElements = document.querySelectorAll('.character');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const roundWinner = document.getElementById('roundWinner');
        const victoryScreen = document.getElementById('victoryScreen');
        const victoryText = document.getElementById('victoryText');
        const rematchButton = document.getElementById('rematchButton');
        const menuButton = document.getElementById('menuButton');

        // Estado do jogo
        let gameRunning = false;
        let gamePaused = false;
        let player1 = null;
        let player2 = null;
        let projectiles = [];
        let monsters = [];
        let effects = [];
        let powerUps = [];
        let lastPowerUpSpawn = 0;
        let keys = {};
        let player1Selected = null;
        let player2Selected = null;
        let gameTime = 0;
        let score = { red: 0, blue: 0 };
        let roundEndTime = 0;
        let roundWinnerTeam = null;
        let lastDirection = {
            red: { x: 1, y: 0 },
            blue: { x: -1, y: 0 }
        };

        // Cores dos personagens
        const characterColors = {
            fireMage: '#f80',    // Laranja
            archer: '#0a0',     // Verde
            knight: '#300',     // Preto
            necromancer: '#808', // Roxo
            lancer: '#0ff',     // Azul ciano
            assassin: '#840'     // Marrom
        };

        // Classes do jogo
        class Player {
            constructor(type, team, x, y) {
                this.type = type;
                this.team = team;
                this.x = x;
                this.y = y;
                this.size = config.playerSize;
                this.speed = config.playerSpeed;
                this.color = characterColors[type];
                this.bulletSpeed = 10;
                this.bulletSize = 8;
                this.bulletColor = team === 'red' ? '#f80' : '#0af';
                this.lastShotTime = 0;
                this.shotInterval = config.basicAttackCooldown[type];
                this.specialCooldown = config.specialCooldown[type];
                this.specialReady = true;
                this.specialActive = false;
                this.specialEndTime = 0;
                this.damage = 0;
                this.maxHealth = 100;
                this.health = this.maxHealth;
                this.invulnerable = false;
                this.swordAngle = 0;
                this.attackCooldown = 0;
                this.lastAttackTime = 0;
                this.attacking = false;
                this.attackDuration = 200;
                this.stunnedUntil = 0;
                this.visible = true;
                this.lastBasicAttackTime = 0;
                this.basicAttackReady = true;
                this.aimAngle = team === 'red' ? 0 : Math.PI;
                this.aimArrow = document.createElement('div');
                this.aimArrow.className = 'aim-arrow';
                document.body.appendChild(this.aimArrow);
                
                // Configura√ß√µes espec√≠ficas por personagem
                switch(type) {
                    case 'fireMage':
                        this.color = characterColors.fireMage;
                        this.bulletColor = team === 'red' ? '#f80' : '#0af';
                        this.bulletSize = 10;
                        this.shotInterval = 700;
                        this.damage = 15;
                        this.maxHealth = 250;
                        this.health = 250;
                        break;
                    case 'archer':
                        this.color = characterColors.archer;
                        this.bulletColor = team === 'red' ? '#f00' : '#00f';
                        this.bulletSize = 6;
                        this.shotInterval = 250;
                        this.damage = 15;
                        this.maxHealth = 215;
                        this.health = 215;
                        this.speed = config.playerSpeed * 1.3;
                        break;
                    case 'knight':
                        this.color = characterColors.knight;
                        this.bulletColor = team === 'red' ? '#a00' : '#00a';
                        this.bulletSize = 7;
                        this.shotInterval = 550;
                        this.damage = 27;
                        this.maxHealth = 325;
                        this.health = 325;
                        this.bulletRange = 200;
                        break;
                    case 'necromancer':
                        this.color = characterColors.necromancer;
                        this.bulletColor = team === 'red' ? '#a00' : '#00a';
                        this.bulletSize = 10;
                        this.shotInterval = 650;
                        this.damage = 45;
                        this.maxHealth = 250;
                        this.health = 250;
                        break;
                    case 'lancer':
                        this.color = characterColors.lancer;
                        this.speed = config.playerSpeed * 1.15;
                        this.attackCooldown = 900;
                        this.lastAttackTime = 0;
                        this.attacking = false;
                        this.attackDuration = 200;
                        this.damage = 55;
                        this.maxHealth = 350;
                        this.health = 350;
                        break;
                    case 'assassin':
                        this.color = characterColors.assassin;
                        this.bulletColor = team === 'red' ? '#a00' : '#00a';
                        this.bulletSize = 5;
                        this.shotInterval = 300;
                        this.damage = 45;
                        this.maxHealth = 220;
                        this.health = 220;
                        this.speed = config.playerSpeed * 1.3;
                        break;
                }
            }
            
            update() {
                if (this.stunnedUntil > Date.now() || gamePaused) return;
                
                // Atualizar cooldown do ataque b√°sico
                if (!this.basicAttackReady) {
                    const elapsed = Date.now() - this.lastBasicAttackTime;
                    const percent = (elapsed / this.shotInterval) * 100;
                    this.updateBasicAttackBar(percent);
                    
                    if (elapsed >= this.shotInterval) {
                        this.basicAttackReady = true;
                        this.updateBasicAttackBar(100);
                    }
                }
                
                // Movimento
                let moveX = 0;
                let moveY = 0;
                
                if (this.team === 'red') {
                    if (keys['w']) moveY -= this.speed;
                    if (keys['s']) moveY += this.speed;
                    if (keys['a']) moveX -= this.speed;
                    if (keys['d']) moveX += this.speed;
                } else {
                    if (keys['ArrowUp']) moveY -= this.speed;
                    if (keys['ArrowDown']) moveY += this.speed;
                    if (keys['ArrowLeft']) moveX -= this.speed;
                    if (keys['ArrowRight']) moveX += this.speed;
                }
                
                // Atualizar dire√ß√£o da mira
                if (moveX !== 0 || moveY !== 0) {
                    this.aimAngle = Math.atan2(moveY, moveX);
                    lastDirection[this.team] = { x: moveX, y: moveY };
                } else {
                    // Manter a √∫ltima dire√ß√£o se n√£o estiver se movendo
                    const lastDir = lastDirection[this.team];
                    if (lastDir.x !== 0 || lastDir.y !== 0) {
                        this.aimAngle = Math.atan2(lastDir.y, lastDir.x);
                    }
                }
                
                // Normalizar movimento diagonal
                if (moveX !== 0 && moveY !== 0) {
                    moveX *= 0.7071; // 1/sqrt(2)
                    moveY *= 0.7071;
                }
                
                this.x += moveX;
                this.y += moveY;
                
                // Limitar ao canvas (com borda vermelha)
                const borderSize = 10;
                this.x = Math.max(this.size + borderSize, Math.min(config.width - this.size - borderSize, this.x));
                this.y = Math.max(this.size + borderSize, Math.min(config.height - this.size - borderSize, this.y));
                
                // Atualizar posi√ß√£o do rosto e seta de mira
               
                this.aimArrow.style.left = `${this.x + window.scrollX + Math.cos(this.aimAngle) * (this.size + 10) - 7}px`;
                this.aimArrow.style.top = `${this.y + window.scrollY + Math.sin(this.aimAngle) * (this.size + 10) - 7}px`;
                this.aimArrow.style.transform = `rotate(${this.aimAngle}rad)`;
                
                // Verificar se habilidade especial est√° ativa
                if (this.specialActive && Date.now() > this.specialEndTime) {
                    this.specialActive = false;
                    
                    if (this.type === 'archer') {
                        this.speed = config.playerSpeed;
                    } else if (this.type === 'knight') {
                        this.invulnerable = false;
                        this.speed = config.playerSpeed;
                    } else if (this.type === 'lancer') {
                        this.invulnerable = false;
                        this.speed = config.playerSpeed * 1.15;
                    } else if (this.type === 'assassin') {
                        this.visible = true;
                        this.speed = config.playerSpeed * 1.3;
                    }
                }
                
                // Atualizar √¢ngulo da espada do cavaleiro ou lan√ßa do lanceiro
                if (this.type === 'knight' || this.type === 'lancer') {
                    this.swordAngle = this.aimAngle;
                }
                
                // Verificar se est√° atacando (lanceiro)
                if (this.type === 'lancer' && this.attacking && Date.now() > this.lastAttackTime + this.attackDuration) {
                    this.attacking = false;
                }
            }
            
            draw() {
                if (!this.visible) return;
                
                // Desenhar jogador com transpar√™ncia se estiver invulner√°vel ou invis√≠vel
                if (this.invulnerable || (this.type === 'assassin' && this.specialActive)) {
                    ctx.globalAlpha = 0.6;
                }
                
                // Desenhar jogador atordoado
                if (this.stunnedUntil > Date.now()) {
                    ctx.fillStyle = '#888';
                } else {
                    ctx.fillStyle = this.color;
                }
                
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                
                // Resetar transpar√™ncia
                ctx.globalAlpha = 1.0;
                
                // Desenhar aura se for mago de fogo com especial ativo
                if (this.type === 'fireMage' && this.specialActive) {
                    ctx.strokeStyle = this.team === 'red' ? 'rgba(255, 100, 0, 0.5)' : 'rgba(0, 100, 255, 0.5)';
                    ctx.lineWidth = 10;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size + 30, 0, Math.PI * 2);
                    ctx.stroke();
                }
                
                // Desenhar espada se for cavaleiro com especial ativo
                if (this.type === 'knight' && this.specialActive) {
                    const swordLength = this.size * 2;
                    const swordEndX = this.x + Math.cos(this.swordAngle) * swordLength;
                    const swordEndY = this.y + Math.sin(this.swordAngle) * swordLength;
                    
                    // L√¢mina da espada (cinza)
                    ctx.strokeStyle = '#ccc';
                    ctx.lineWidth = 5;
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y);
                    ctx.lineTo(swordEndX, swordEndY);
                    ctx.stroke();
                    
                    // Base da espada (marrom)
                    ctx.strokeStyle = '#840';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y);
                    ctx.lineTo(this.x + Math.cos(this.swordAngle) * this.size * 0.7, this.y + Math.sin(this.swordAngle) * this.size * 0.7);
                    ctx.stroke();
                    
                    // Ponta da espada
                    ctx.fillStyle = '#ccc';
                    ctx.beginPath();
                    ctx.arc(swordEndX, swordEndY, 5, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Desenhar lan√ßa do lanceiro
                if (this.type === 'lancer') {
                    const lanceLength = this.size * 2.3;
                    const lanceEndX = this.x + Math.cos(this.swordAngle) * lanceLength;
                    const lanceEndY = this.y + Math.sin(this.swordAngle) * lanceLength;
                    
                    // Cor da lan√ßa muda quando est√° atacando
                    const lanceTipColor = this.attacking ? '#f00' : '#fff';
                    
                    // Haste da lan√ßa (marrom)
                    ctx.strokeStyle = '#840';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y);
                    ctx.lineTo(lanceEndX, lanceEndY);
                    ctx.stroke();
                    
                    // Ponta da lan√ßa (branca ou vermelha)
                    ctx.fillStyle = lanceTipColor;
                    ctx.beginPath();
                    ctx.arc(lanceEndX, lanceEndY, 3, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Desenhar nome do personagem
                ctx.fillStyle = '#fff';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(this.type === 'fireMage' ? 'üî•' : 
                            this.type === 'archer' ? 'üèπ' : 
                            this.type === 'knight' ? '‚öîÔ∏è' :
                            this.type === 'necromancer' ? '‚ò†Ô∏è' :
                            this.type === 'lancer' ? 'üî±' : 'üó°Ô∏è', 
                            this.x, this.y - this.size - 5);
            }
            
            shoot() {
                // Verificar se pode atirar (intervalo e se n√£o est√° atordoado)
                const now = Date.now();
                if (!this.basicAttackReady || 
                    this.stunnedUntil > now ||
                    (this.type === 'knight' && this.specialActive) ||
                    this.type === 'lancer' ||
                    gamePaused) {
                    return;
                }
                
                this.lastBasicAttackTime = now;
                this.basicAttackReady = false;
                this.updateBasicAttackBar(0);
                
                // Usar √¢ngulo de mira atual
                const angle = this.aimAngle;
                
                switch(this.type) {
                    case 'fireMage':
                        // Mago atira dois proj√©teis um atr√°s do outro com delay
                        const offset = 15;
                        const bullet1 = new Bullet(
                            this.x + Math.cos(angle) * offset,
                            this.y + Math.sin(angle) * offset,
                            angle,
                            this.bulletSpeed,
                            this.bulletSize,
                            this.bulletColor,
                            this.damage,
                            this.team,
                            'burn',
                            { damage: 3, duration: 3000 }
                        );
                        
                        projectiles.push(bullet1);
                        
                        // Segundo projetil com delay
                        setTimeout(() => {
                            if (gameRunning && !gamePaused) {
                                const bullet2 = new Bullet(
                                    this.x + Math.cos(angle) * offset,
                                    this.y + Math.sin(angle) * offset,
                                    angle,
                                    this.bulletSpeed,
                                    this.bulletSize,
                                    this.bulletColor,
                                    this.damage,
                                    this.team
                                );
                                projectiles.push(bullet2);
                            }
                        }, 100);
                        break;
                        
                    case 'archer':
                        // Arqueiro atira uma flecha
                        const arrow = new Bullet(
                            this.x,
                            this.y,
                            angle,
                            this.bulletSpeed * 1.3,
                            this.bulletSize,
                            this.bulletColor,
                            this.damage,
                            this.team
                        );
                        projectiles.push(arrow);
                        break;
                        
                    case 'knight':
                        // Cavaleiro atira tr√™s balas em leque com alcance curto
                        for (let i = -1; i <= 1; i++) {
                            const spreadAngle = angle + (i * 0.2);
                            const bullet = new Bullet(
                                this.x,
                                this.y,
                                spreadAngle,
                                this.bulletSpeed,
                                this.bulletSize,
                                this.bulletColor,
                                this.damage,
                                this.team,
                                null,
                                null,
                                this.bulletRange
                            );
                            projectiles.push(bullet);
                        }
                        break;
                        
                    case 'necromancer':
                        // Necromante atira uma esfera que se divide
                        const orb = new Bullet(
                            this.x,
                            this.y,
                            angle,
                            this.bulletSpeed * 1.1,
                            this.bulletSize,
                            this.bulletColor,
                            this.damage,
                            this.team,
                            'split',
                            { count: 3, damage: 15, angleSpread: 0.3 }
                        );
                        projectiles.push(orb);
                        break;
                        
                    case 'assassin':
                        // Assassino d√° um dash e atira uma faca
                        const dashDistance = 30;
                        this.x += Math.cos(angle) * dashDistance;
                        this.y += Math.sin(angle) * dashDistance;
                        
                        // Limitar ao canvas (com borda vermelha)
                        const borderSize = 10;
                        this.x = Math.max(this.size + borderSize, Math.min(config.width - this.size - borderSize, this.x));
                        this.y = Math.max(this.size + borderSize, Math.min(config.height - this.size - borderSize, this.y));
                        
                        const dagger = new Bullet(
                            this.x,
                            this.y,
                            angle,
                            this.bulletSpeed * 1.8,
                            this.bulletSize,
                            this.bulletColor,
                            this.damage,
                            this.team,
                            'bleed',
                            { damage: 7, duration: 2000 }
                        );
                        projectiles.push(dagger);
                        
                        // Cooldown maior se acertar o oponente
                        const opponent = this.team === 'red' ? player2 : player1;
                        const distance = Math.sqrt(
                            Math.pow(opponent.x - this.x, 2) + 
                            Math.pow(opponent.y - this.y, 2)
                        );
                        
                        if (distance < opponent.size + this.size + 20) {
                            this.shotInterval = 1500;
                        } else {
                            this.shotInterval = 300;
                        }
                        break;
                }
            }
            
            attack() {
                // Ataque do lanceiro
                if (this.type !== 'lancer') return;
                
                const now = Date.now();
                if (now - this.lastAttackTime < this.attackCooldown || this.stunnedUntil > now || gamePaused) {
                    return;
                }
                
                this.lastAttackTime = now;
                this.attacking = true;
                
                // Verificar colis√£o com o oponente
                const opponent = this.team === 'red' ? player2 : player1;
                const lanceLength = this.size * 2.5;
                const lanceEndX = this.x + Math.cos(this.swordAngle) * lanceLength;
                const lanceEndY = this.y + Math.sin(this.swordAngle) * lanceLength;
                
                if (checkLineCircleCollision(
                    this.x, this.y, lanceEndX, lanceEndY,
                    opponent.x, opponent.y, opponent.size
                )) {
                    opponent.takeDamage(this.damage);
                }
            }
            
            useSpecial() {
                if (!this.specialReady || this.specialActive || this.stunnedUntil > Date.now() || gamePaused) return;
                
                this.specialReady = false;
                this.specialActive = true;
                this.updateSpecialBar(0);
                
                switch(this.type) {
                    case 'fireMage':
                        // Criar 50 bolas de fogo em todas as dire√ß√µes
                        for (let i = 0; i < 50; i++) {
                            const angle = (i / 50) * Math.PI * 2;
                            const bullet = new Bullet(
                                this.x,
                                this.y,
                                angle,
                                this.bulletSpeed * 1.3,
                                this.bulletSize * 1.5,
                                this.team === 'red' ? '#f50' : '#05f',
                                20,
                                this.team,
                                'burn',
                                { damage: 10, duration: 3000 }
                            );
                            projectiles.push(bullet);
                        }
                        
                        // Adicionar efeito de aura
                        effects.push({
                            x: this.x,
                            y: this.y,
                            radius: this.size + 30,
                            damage: 5,
                            interval: 500,
                            lastHitTime: 0,
                            duration: 3000,
                            startTime: Date.now(),
                            type: 'aura',
                            team: this.team
                        });
                        
                        // Efeito especial de fogo
                        effects.push({
                            x: this.x,
                            y: this.y,
                            radius: this.size + 50,
                            duration: 3000,
                            startTime: Date.now(),
                            type: 'fireSpecial',
                            team: this.team
                        });
                        
                        this.specialEndTime = Date.now();
                        break;
                        
                    case 'archer':
                        // Atirar 25 flechas na dire√ß√£o do oponente
                        const angle = this.aimAngle;
                        for (let i = 0; i < 25; i++) {
                            const spreadAngle = angle + (Math.random() - 0.5) * 0.5;
                            const arrow = new Bullet(
                                this.x,
                                this.y,
                                spreadAngle,
                                this.bulletSpeed * 1.5,
                                this.bulletSize,
                                this.bulletColor,
                                10,
                                this.team
                            );
                            projectiles.push(arrow);
                        }
                        
                        // Dash para tr√°s
                        const dashAngle = angle + Math.PI;
                        this.x += Math.cos(dashAngle) * 100;
                        this.y += Math.sin(dashAngle) * 100;
                        
                        // Limitar ao canvas (com borda vermelha)
                        const borderSize = 10;
                        this.x = Math.max(this.size + borderSize, Math.min(config.width - this.size - borderSize, this.x));
                        this.y = Math.max(this.size + borderSize, Math.min(config.height - this.size - borderSize, this.y));
                        
                        // Efeito de sombra
                        effects.push({
                            x: this.x - Math.cos(dashAngle) * 50,
                            y: this.y - Math.sin(dashAngle) * 50,
                            radius: this.size,
                            alpha: 0.7,
                            duration: 1000,
                            startTime: Date.now(),
                            type: 'shadow',
                            color: this.color
                        });
                        
                        this.specialEndTime = Date.now();
                        break;
                        
                    case 'knight':
                        // Ativar modo espada e invulnerabilidade
                        this.invulnerable = true;
                        this.speed = config.playerSpeed * 1.3;
                        this.specialEndTime = Date.now() + 3000; 
                        
                        // Efeito de espada
                        setInterval(() => {
                            if (!this.specialActive) return;
                            
                            const swordLength = this.size * 2.5;
                            const swordEndX = this.x + Math.cos(this.swordAngle) * swordLength;
                            const swordEndY = this.y + Math.sin(this.swordAngle) * swordLength;
                            
                            const target = this.team === 'red' ? player2 : player1;
                            if (checkLineCircleCollision(
                                this.x, this.y, swordEndX, swordEndY,
                                target.x, target.y, target.size
                            )) {
                                target.takeDamage(10);
                            }
                        }, 780);
                        
                        // Efeito especial de espada
                        effects.push({
                            x: this.x,
                            y: this.y,
                            angle: this.swordAngle,
                            duration: 3000,
                            startTime: Date.now(),
                            type: 'swordSpecial',
                            team: this.team
                        });
                        break;
                        
                    case 'necromancer':
                        // Invocar 3 monstros (30% de chance do terceiro ser venenoso)
                        for (let i = 0; i < 3; i++) {
                            const isPoison = i === 2 && Math.random() < 0.3;
                            
                            const monster = new Monster(
                                this.x + (Math.random() - 0.5) * 50,
                                this.y + (Math.random() - 0.5) * 50,
                                this.team,
                                isPoison
                            );
                            monsters.push(monster);
                        }
                        
                        // Efeito especial de necromante
                        effects.push({
                            x: this.x,
                            y: this.y,
                            radius: this.size + 40,
                            duration: 1500,
                            startTime: Date.now(),
                            type: 'necromancerSpecial',
                            team: this.team
                        });
                        
                        this.specialEndTime = Date.now();
                        break;
                        
                    case 'lancer':
                        // Investida violenta
                        this.invulnerable = true;
                        this.speed = config.playerSpeed * 2.5;
                        this.specialEndTime = Date.now() + 2000; // 1 segundo de investida
                        
                        // Verificar colis√£o durante a investida
                        const checkCollision = setInterval(() => {
                            if (!this.specialActive) {
                                clearInterval(checkCollision);
                                return;
                            }
                            
                            const opponent = this.team === 'red' ? player2 : player1;
                            const distance = Math.sqrt(
                                Math.pow(this.x - opponent.x, 2) + 
                                Math.pow(this.y - opponent.y, 2)
                            );
                            
                            if (distance < this.size + opponent.size) {
                                // Acertou o oponente
                                opponent.takeDamage(100);
                                opponent.stunnedUntil = Date.now() + 2500; // 2.5 segundos de atordoamento
                                this.specialActive = false;
                                this.invulnerable = false;
                                this.speed = config.playerSpeed * 1.15;
                                clearInterval(checkCollision);
                            }
                            
                            // Verificar colis√£o com borda
                            const borderSize = 10;
                            if (this.x <= this.size + borderSize || 
                                this.x >= config.width - this.size - borderSize ||
                                this.y <= this.size + borderSize || 
                                this.y >= config.height - this.size - borderSize) {
                                this.specialActive = false;
                                this.invulnerable = false;
                                this.speed = config.playerSpeed * 1.15;
                                clearInterval(checkCollision);
                            }
                        }, 50);
                        
                        // Efeito especial de investida
                        effects.push({
                            x: this.x,
                            y: this.y,
                            angle: this.swordAngle,
                            duration: 2000,
                            startTime: Date.now(),
                            type: 'lancerSpecial',
                            team: this.team
                        });
                        break;
                        
                    case 'assassin':
                        // Invisibilidade e velocidade aumentada
                        this.visible = false;
                        this.speed = config.playerSpeed * 2; // 100% mais r√°pido
                        this.specialEndTime = Date.now() + 2400; // 4 segundos
                        
                        // Atirar 3 adagas envenenadas em dire√ß√µes aleat√≥rias
                        for (let i = 0; i < 5; i++) {
                            const angle = Math.random() * Math.PI * 2;
                            const dagger = new Bullet(
                                this.x,
                                this.y,
                                angle,
                                this.bulletSpeed * 1.5,
                                this.bulletSize,
                                this.bulletColor,
                                10,
                                this.team,
                                'poison',
                                { damage: 5, duration: 5000, slow: 0.25 }
                            );
                            projectiles.push(dagger);
                        }
                        
                        // Efeito especial de assassin
                        effects.push({
                            x: this.x,
                            y: this.y,
                            duration: 2400,
                            startTime: Date.now(),
                            type: 'assassinSpecial',
                            team: this.team
                        });
                        break;
                }
                
                // Iniciar cooldown
                setTimeout(() => {
                    this.specialReady = true;
                    this.updateSpecialBar(100);
                }, this.specialCooldown);
            }
            
            takeDamage(amount) {
                if (this.invulnerable || this.stunnedUntil > Date.now()) return;
                
                this.health -= amount;
                this.updateHealthBar();
                
                if (this.health <= 0) {
                    // Ponto vai para o time que foi morto (inverso)
                    roundOver(this.team === 'red' ? 'blue' : 'red');
                }
            }
            
            heal(amount) {
                this.health = Math.min(this.maxHealth, this.health + amount);
                this.updateHealthBar();
            }
            
            updateHealthBar() {
                const healthBar = this.team === 'red' ? 
                    player1Info.querySelector('.health-fill') : 
                    player2Info.querySelector('.health-fill');
                healthBar.style.width = `${(this.health / this.maxHealth) * 100}%`;
            }
            
            updateSpecialBar(percent) {
                const specialBar = this.team === 'red' ? 
                    player1Info.querySelector('.special-fill') : 
                    player2Info.querySelector('.special-fill');
                specialBar.style.width = `${percent}%`;
            }
            
            updateBasicAttackBar(percent) {
                const basicAttackBar = this.team === 'red' ? 
                    player1Info.querySelector('.basic-attack-fill') : 
                    player2Info.querySelector('.basic-attack-fill');
                basicAttackBar.style.width = `${percent}%`;
            }
            
            destroy() {
                // Remover elementos DOM quando o jogador for destru√≠do
               
                if (this.aimArrow.parentNode) {
                    this.aimArrow.parentNode.removeChild(this.aimArrow);
                }
            }
        }

        class Bullet {
            constructor(x, y, angle, speed, size, color, damage, team, effectType = null, effectData = null, range = null) {
                this.x = x;
                this.y = y;
                this.angle = angle;
                this.speed = speed;
                this.size = size;
                this.color = color;
                this.damage = damage;
                this.team = team;
                this.effectType = effectType;
                this.effectData = effectData;
                this.range = range;
                this.distanceTraveled = 0;
                this.startX = x;
                this.startY = y;
                this.shouldSplit = false;
                
                if (effectType === 'split') {
                    this.splitDistance = this.range ? this.range / 2 : 300;
                }
            }
            
            update() {
                this.x += Math.cos(this.angle) * this.speed;
                this.y += Math.sin(this.angle) * this.speed;
                this.distanceTraveled = Math.sqrt((this.x - this.startX) ** 2 + (this.y - this.startY) ** 2);
                
                // Verificar divis√£o do projetil (necromante)
                if (this.effectType === 'split' && !this.shouldSplit && 
                    this.distanceTraveled >= this.splitDistance) {
                    this.shouldSplit = true;
                    this.split();
                    return true; // Remove o projetil original ap√≥s a divis√£o
                }
                
                // Verificar se saiu da tela ou atingiu o alcance m√°ximo
                return this.x < -this.size || this.x > config.width + this.size || 
                       this.y < -this.size || this.y > config.height + this.size ||
                       (this.range !== null && this.distanceTraveled >= this.range);
            }
            
            split() {
                if (this.effectType !== 'split') return;
                
                for (let i = -1; i <= 1; i++) {
                    const spreadAngle = this.angle + (i * this.effectData.angleSpread);
                    const bullet = new Bullet(
                        this.x,
                        this.y,
                        spreadAngle,
                        this.speed * 0.9,
                        this.size * 0.8,
                        this.color,
                        this.effectData.damage,
                        this.team
                    );
                    projectiles.push(bullet);
                }
            }
            
            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        class Monster {
            constructor(x, y, team, isPoison = false) {
                this.x = x;
                this.y = y;
                this.size = 12;
                this.speed = 2;
                this.team = team;
                this.color = isPoison ? '#0a0' : (team === 'red' ? '#a00' : '#00a');
                this.health = isPoison ? 45 : 65;
                this.maxHealth = this.health;
                this.damage = isPoison ? 30 : 29;
                this.lastHitTime = 0;
                this.hitInterval = 1000;
                this.isPoison = isPoison;
                this.poisonDamage = 5;
                this.poisonDuration = 5000;
                this.slowAmount = 0.25;
                this.lastShotTime = 0;
                this.shotInterval = 2000;
            }
            
            update() {
                if (gamePaused) return;
                
                // Monstros venenosos atiram de longe
                if (this.isPoison) {
                    const now = Date.now();
                    if (now - this.lastShotTime > this.shotInterval) {
                        this.lastShotTime = now;
                        
                        const target = this.team === 'red' ? player2 : player1;
                        const angle = Math.atan2(target.y - this.y, target.x - this.x);
                        
                        const poisonBall = new Bullet(
                            this.x,
                            this.y,
                            angle,
                            5,
                            8,
                            '#0f0',
                            this.damage,
                            this.team,
                            'poison',
                            { damage: this.poisonDamage, duration: this.poisonDuration, slow: this.slowAmount }
                        );
                        projectiles.push(poisonBall);
                    }
                }
                
                // Encontrar alvo (jogador inimigo ou monstros do time oposto)
                let target = this.team === 'red' ? player2 : player1;
                let targetDistance = Math.sqrt(Math.pow(this.x - target.x, 2) + Math.pow(this.y - target.y, 2));
                
                // Verificar se h√° monstros do time oposto mais pr√≥ximos
                for (const monster of monsters) {
                    if (monster.team !== this.team) {
                        const distance = Math.sqrt(Math.pow(this.x - monster.x, 2) + Math.pow(this.y - monster.y, 2));
                        if (distance < targetDistance) {
                            target = monster;
                            targetDistance = distance;
                        }
                    }
                }
                
                // Mover em dire√ß√£o ao alvo (se n√£o for venenoso ou se estiver perto)
                if (!this.isPoison || targetDistance < 200) {
                    const angle = Math.atan2(target.y - this.y, target.x - this.x);
                    this.x += Math.cos(angle) * this.speed;
                    this.y += Math.sin(angle) * this.speed;
                }
                
                // Verificar colis√£o com o alvo (se n√£o for venenoso)
                if (!this.isPoison) {
                    const distance = Math.sqrt(Math.pow(this.x - target.x, 2) + Math.pow(this.y - target.y, 2));
                    if (distance < this.size + target.size) {
                        const now = Date.now();
                        if (now - this.lastHitTime > this.hitInterval) {
                            target.takeDamage(this.damage);
                            this.lastHitTime = now;
                        }
                    }
                }
            }
            
            draw() {
                // Corpo do monstro
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                
                // Olhos do monstro
                ctx.fillStyle = '#fff';
                ctx.beginPath();
                ctx.arc(this.x - 4, this.y - 2, 2, 0, Math.PI * 2);
                ctx.arc(this.x + 4, this.y - 2, 2, 0, Math.PI * 2);
                ctx.fill();
                
                // Boca do monstro
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.arc(this.x, this.y + 3, 3, 0.1 * Math.PI, 0.9 * Math.PI);
                ctx.stroke();
                
                // Barra de vida
                const barWidth = this.size * 2;
                const barHeight = 3;
                const healthPercent = this.health / this.maxHealth;
                
                ctx.fillStyle = '#333';
                ctx.fillRect(this.x - barWidth/2, this.y - this.size - 8, barWidth, barHeight);
                ctx.fillStyle = this.isPoison ? '#0f0' : '#f00';
                ctx.fillRect(this.x - barWidth/2, this.y - this.size - 8, barWidth * healthPercent, barHeight);
            }
            
            takeDamage(amount) {
                this.health -= amount;
                return this.health <= 0;
            }
        }

        class PowerUp {
            constructor(type) {
                this.type = type;
                this.size = 15;
                this.x = Math.random() * (config.width - 40) + 20;
                this.y = Math.random() * (config.height - 40) + 20;
                
                switch(type) {
                    case 'health20':
                        this.color = '#0a0';
                        this.healAmount = 20;
                        break;
                    case 'health40':
                        this.color = '#080';
                        this.healAmount = 40;
                        break;
                    case 'health80':
                        this.color = '#050';
                        this.healAmount = 80;
                        break;
                    case 'infiniteAmmo':
                        this.color = '#00f';
                        this.duration = 5000;
                        break;
                }
            }
            
            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x - this.size/2, this.y - this.size/2, this.size, this.size);
                
                // Desenhar borda
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.strokeRect(this.x - this.size/2, this.y - this.size/2, this.size, this.size);
                
                // Desenhar √≠cone
                ctx.fillStyle = '#fff';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                if (this.type.includes('health')) {
                    ctx.fillText('+', this.x, this.y - 2);
                    ctx.fillText(this.healAmount, this.x, this.y + 10);
                } else {
                    ctx.fillText('‚àû', this.x, this.y + 3);
                }
            }
            
            checkCollision(player) {
                const dx = player.x - this.x;
                const dy = player.y - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < player.size + this.size) {
                    if (this.type.includes('health')) {
                        player.heal(this.healAmount);
                    } else if (this.type === 'infiniteAmmo') {
                        player.shotInterval = 100; // Tiro muito r√°pido
                        setTimeout(() => {
                            if (player.type === 'fireMage') player.shotInterval = 700;
                            else if (player.type === 'archer') player.shotInterval = 250;
                            else if (player.type === 'knight') player.shotInterval = 550;
                            else if (player.type === 'necromancer') player.shotInterval = 650;
                            else if (player.type === 'assassin') player.shotInterval = 300;
                        }, this.duration);
                    }
                    return true;
                }
                return false;
            }
        }

        // Fun√ß√µes do jogo
        function spawnPowerUp() {
            const types = ['health20', 'health40', 'health80', 'infiniteAmmo'];
            const weights = [0.4, 0.3, 0.2, 0.1]; // Probabilidades para cada tipo
            const totalWeight = weights.reduce((a, b) => a + b, 0);
            let random = Math.random() * totalWeight;
            let typeIndex = 0;
            
            for (let i = 0; i < weights.length; i++) {
                if (random < weights[i]) {
                    typeIndex = i;
                    break;
                }
                random -= weights[i];
            }
            
            powerUps.push(new PowerUp(types[typeIndex]));
        }

        function roundOver(winningTeam) {
            gameRunning = false;
            gamePaused = true;
            roundWinnerTeam = winningTeam;
            roundEndTime = Date.now() + 2000; // 2 segundos
            
            // Atualizar placar
            score[winningTeam]++;
            updateScoreDisplay();
            
            // Mostrar mensagem do round
            roundWinner.textContent = winningTeam === 'red' ? 'Ponto Time Vermelho' : 'Ponto Time Azul';
            roundWinner.style.color = winningTeam === 'red' ? '#f00' : '#00f';
            roundWinner.style.display = 'block';
            
            // Verificar vit√≥ria
            if (score[winningTeam] >= 3) {
                setTimeout(() => {
                    gameOver(winningTeam);
                }, 2000);
            }
        }

        function gameOver(winningTeam) {
            gameRunning = false;
            victoryScreen.style.display = 'flex';
            victoryText.textContent = `Vit√≥ria Time ${winningTeam === 'red' ? 'Vermelho' : 'Azul'}!`;
            victoryText.style.color = winningTeam === 'red' ? '#f00' : '#00f';
            victoryText.style.textShadow = `0 0 20px ${winningTeam === 'red' ? '#f00' : '#00f'}`;
            
            // Efeito de confete
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.style.position = 'absolute';
                    confetti.style.width = '10px';
                    confetti.style.height = '10px';
                    confetti.style.backgroundColor = winningTeam === 'red' ? 
                        (Math.random() > 0.5 ? '#f00' : '#f80') : 
                        (Math.random() > 0.5 ? '#00f' : '#0af');
                    confetti.style.left = `${Math.random() * 100}%`;
                    confetti.style.top = '-10px';
                    confetti.style.borderRadius = '50%';
                    confetti.style.zIndex = '30';
                    document.body.appendChild(confetti);
                    
                    const angle = Math.random() * Math.PI * 2;
                    const distance = 100 + Math.random() * 200;
                    const duration = 2 + Math.random() * 3;
                    
                    confetti.animate([
                        { transform: `translate(0, 0) rotate(0deg)`, opacity: 1 },
                        { transform: `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance + window.innerHeight}px) rotate(${Math.random() * 360}deg)`, opacity: 0 }
                    ], {
                        duration: duration * 1000,
                        easing: 'cubic-bezier(0.1, 0.8, 0.9, 1)'
                    });
                    
                    setTimeout(() => {
                        if (confetti.parentNode) {
                            confetti.parentNode.removeChild(confetti);
                        }
                    }, duration * 1000);
                }, i * 50);
            }
        }

        function resetGame() {
            // Remover elementos de rosto e seta dos jogadores anteriores
            if (player1) player1.destroy();
            if (player2) player2.destroy();
            
            // Posicionar jogadores em lados opostos
            player1 = new Player(player1Selected, 'red', config.width * 0.25, config.height / 2);
            player2 = new Player(player2Selected, 'blue', config.width * 0.75, config.height / 2);
            
            projectiles = [];
            monsters = [];
            effects = [];
            powerUps = [];
            lastPowerUpSpawn = 0;
            gameTime = 0;
            gameOverScreen.style.display = 'none';
            victoryScreen.style.display = 'none';
            roundWinner.style.display = 'none';
            gameRunning = true;
            gamePaused = false;
            
            // Atualizar nomes dos jogadores
            player1Info.querySelector('.player-name').textContent = 
                player1Selected === 'fireMage' ? 'Mago de Fogo' : 
                player1Selected === 'archer' ? 'Arqueiro Real' : 
                player1Selected === 'knight' ? 'Cavaleiro Negro' :
                player1Selected === 'necromancer' ? 'Necromante' :
                player1Selected === 'lancer' ? 'Lanceiro' : 'Assassino';
            
            player2Info.querySelector('.player-name').textContent = 
                player2Selected === 'fireMage' ? 'Mago de Fogo' : 
                player2Selected === 'archer' ? 'Arqueiro Real' : 
                player2Selected === 'knight' ? 'Cavaleiro Negro' :
                player2Selected === 'necromancer' ? 'Necromante' :
                player2Selected === 'lancer' ? 'Lanceiro' : 'Assassino';
        }

        function newMatch() {
            score = { red: 0, blue: 0 };
            updateScoreDisplay();
            resetGame();
        }

        function returnToMenu() {
            // Remover elementos de rosto e seta
            if (player1) player1.destroy();
            if (player2) player2.destroy();
            
            gameRunning = false;
            victoryScreen.style.display = 'none';
            gameUI.style.display = 'none';
            menu.style.display = 'flex';
            score = { red: 0, blue: 0 };
            updateScoreDisplay();
        }

        function updateScoreDisplay() {
            scoreDisplay.textContent = `Vermelho ${score.red} - ${score.blue} Azul`;
        }

        function update() {
            if (!gameRunning || gamePaused) {
                // Verificar se o round acabou e o tempo de pausa terminou
                if (roundWinnerTeam && Date.now() > roundEndTime) {
                    roundWinnerTeam = null;
                    gamePaused = false;
                    gameRunning = true;
                    resetGame();
                }
                return;
            }
            
            const now = Date.now();
            gameTime = now;
            
            // Atualizar jogadores
            player1.update();
            player2.update();
            
            // Spawn de power-ups
            if (now - lastPowerUpSpawn > config.powerUpSpawnRate) {
                spawnPowerUp();
                lastPowerUpSpawn = now;
            }
            
            // Atualizar proj√©teis
            for (let i = projectiles.length - 1; i >= 0; i--) {
                if (projectiles[i].update()) {
                    projectiles.splice(i, 1);
                } else {
                    // Verificar colis√£o com jogadores
                    const bullet = projectiles[i];
                    const targetPlayer = bullet.team === 'red' ? player2 : player1;
                    
                    const dx = targetPlayer.x - bullet.x;
                    const dy = targetPlayer.y - bullet.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < targetPlayer.size + bullet.size) {
                        targetPlayer.takeDamage(bullet.damage);
                        
                        // Aplicar efeitos se houver
                        if (bullet.effectType === 'burn') {
                            effects.push({
                                target: targetPlayer,
                                damage: bullet.effectData.damage,
                                interval: 1000,
                                lastHitTime: now,
                                duration: bullet.effectData.duration,
                                startTime: now,
                                type: 'burn'
                            });
                        } else if (bullet.effectType === 'bleed') {
                            effects.push({
                                target: targetPlayer,
                                damage: bullet.effectData.damage,
                                interval: 1000,
                                lastHitTime: now,
                                duration: bullet.effectData.duration,
                                startTime: now,
                                type: 'bleed'
                            });
                        } else if (bullet.effectType === 'poison') {
                            effects.push({
                                target: targetPlayer,
                                damage: bullet.effectData.damage,
                                interval: 1000,
                                lastHitTime: now,
                                duration: bullet.effectData.duration,
                                startTime: now,
                                type: 'poison',
                                slow: bullet.effectData.slow
                            });
                        }
                        
                        projectiles.splice(i, 1);
                    }
                    
                    // Verificar colis√£o com monstros
                    for (let j = monsters.length - 1; j >= 0; j--) {
                        const monster = monsters[j];
                        if (monster.team !== bullet.team) {
                            const mdx = monster.x - bullet.x;
                            const mdy = monster.y - bullet.y;
                            const mDistance = Math.sqrt(mdx * mdx + mdy * mdy);
                            
                            if (mDistance < monster.size + bullet.size) {
                                if (monster.takeDamage(bullet.damage)) {
                                    monsters.splice(j, 1);
                                }
                                projectiles.splice(i, 1);
                                break;
                            }
                        }
                    }
                }
            }
            
            // Atualizar monstros
            for (let i = monsters.length - 1; i >= 0; i--) {
                monsters[i].update();
                
                // Verificar se monstro morreu
                if (monsters[i].health <= 0) {
                    monsters.splice(i, 1);
                }
            }
            
            // Atualizar power-ups
            for (let i = powerUps.length - 1; i >= 0; i--) {
                if (powerUps[i].checkCollision(player1) || powerUps[i].checkCollision(player2)) {
                    powerUps.splice(i, 1);
                }
            }
            
            // Atualizar efeitos
            for (let i = effects.length - 1; i >= 0; i--) {
                const effect = effects[i];
                
                if (now - effect.startTime > effect.duration) {
                    effects.splice(i, 1);
                    continue;
                }
                
                if (effect.type === 'burn' || effect.type === 'bleed' || effect.type === 'poison') {
                    if (now - effect.lastHitTime > effect.interval) {
                        effect.target.takeDamage(effect.damage);
                        
                        // Aplicar lentid√£o se for veneno
                        if (effect.type === 'poison' && effect.slow && !effect.target.slowed) {
                            const originalSpeed = effect.target.speed;
                            effect.target.speed *= (1 - effect.slow);
                            effect.target.slowed = true;
                            
                            setTimeout(() => {
                                effect.target.speed = originalSpeed;
                                effect.target.slowed = false;
                            }, effect.duration);
                        }
                        
                        effect.lastHitTime = now;
                    }
                } else if (effect.type === 'aura') {
                    // Aura de fogo do mago
                    effect.x = effect.team === 'red' ? player1.x : player2.x;
                    effect.y = effect.team === 'red' ? player1.y : player2.y;
                    
                    // Verificar colis√£o com jogador inimigo
                    const targetPlayer = effect.team === 'red' ? player2 : player1;
                    const distance = Math.sqrt(
                        Math.pow(targetPlayer.x - effect.x, 2) + 
                        Math.pow(targetPlayer.y - effect.y, 2)
                    );
                    
                    if (distance < effect.radius + targetPlayer.size) {
                        if (now - effect.lastHitTime > effect.interval) {
                            targetPlayer.takeDamage(effect.damage);
                            effect.lastHitTime = now;
                        }
                    }
                }
            }
            
            // Cavaleiro com especial ativo - verificar colis√£o com espada
            if (player1.type === 'knight' && player1.specialActive) {
                const swordLength = player1.size * 2;
                const swordEndX = player1.x + Math.cos(player1.swordAngle) * swordLength;
                const swordEndY = player1.y + Math.sin(player1.swordAngle) * swordLength;
                
                if (checkLineCircleCollision(
                    player1.x, player1.y, swordEndX, swordEndY,
                    player2.x, player2.y, player2.size
                )) {
                    player2.takeDamage(5);
                }
            }
            
            if (player2.type === 'knight' && player2.specialActive) {
                const swordLength = player2.size * 2;
                const swordEndX = player2.x + Math.cos(player2.swordAngle) * swordLength;
                const swordEndY = player2.y + Math.sin(player2.swordAngle) * swordLength;
                
                if (checkLineCircleCollision(
                    player2.x, player2.y, swordEndX, swordEndY,
                    player1.x, player1.y, player1.size
                )) {
                    player1.takeDamage(5);
                }
            }
            
            // Lanceiro atacando
            if (player1.type === 'lancer' && player1.attacking) {
                const lanceLength = player1.size * 1.5;
                const lanceEndX = player1.x + Math.cos(player1.swordAngle) * lanceLength;
                const lanceEndY = player1.y + Math.sin(player1.swordAngle) * lanceLength;
                
                if (checkLineCircleCollision(
                    player1.x, player1.y, lanceEndX, lanceEndY,
                    player2.x, player2.y, player2.size
                )) {
                    player2.takeDamage(player1.damage);
                    player1.attacking = false;
                }
            }
            
            if (player2.type === 'lancer' && player2.attacking) {
                const lanceLength = player2.size * 1.5;
                const lanceEndX = player2.x + Math.cos(player2.swordAngle) * lanceLength;
                const lanceEndY = player2.y + Math.sin(player2.swordAngle) * lanceLength;
                
                if (checkLineCircleCollision(
                    player2.x, player2.y, lanceEndX, lanceEndY,
                    player1.x, player1.y, player1.size
                )) {
                    player1.takeDamage(player2.damage);
                    player2.attacking = false;
                }
            }
        }

        function checkLineCircleCollision(x1, y1, x2, y2, cx, cy, r) {
            // Verificar se o ponto mais pr√≥ximo da linha est√° dentro do c√≠rculo
            const lineLength = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
            const u = ((cx - x1) * (x2 - x1) + (cy - y1) * (y2 - y1)) / (lineLength ** 2);
            
            if (u < 0 || u > 1) {
                // O ponto mais pr√≥ximo est√° fora do segmento de linha
                const dist1 = Math.sqrt((cx - x1) ** 2 + (cy - y1) ** 2);
                const dist2 = Math.sqrt((cx - x2) ** 2 + (cy - y2) ** 2);
                return Math.min(dist1, dist2) <= r;
            } else {
                const px = x1 + u * (x2 - x1);
                const py = y1 + u * (y2 - y1);
                const dist = Math.sqrt((cx - px) ** 2 + (cy - py) ** 2);
                return dist <= r;
            }
        }

        function draw() {
            if (!gameRunning) return;
            
            // Limpar tela
            ctx.fillStyle = '#111';
            ctx.fillRect(0, 0, config.width, config.height);
            
            // Desenhar borda vermelha (ring)
            const borderSize = 10;
            ctx.strokeStyle = '#f00';
            ctx.lineWidth = borderSize;
            ctx.strokeRect(borderSize/2, borderSize/2, config.width - borderSize, config.height - borderSize);
            
            // Desenhar divis√£o da arena
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(config.width / 2, 0);
            ctx.lineTo(config.width / 2, config.height);
            ctx.stroke();
            
            // Desenhar power-ups
            for (const powerUp of powerUps) {
                powerUp.draw();
            }
            
            // Desenhar monstros
            for (const monster of monsters) {
                monster.draw();
            }
            
            // Desenhar proj√©teis
            for (const bullet of projectiles) {
                bullet.draw();
            }
            
            // Desenhar jogadores
            player1.draw();
            player2.draw();
            
            // Desenhar efeitos
            for (const effect of effects) {
                if (effect.type === 'aura') {
                    ctx.strokeStyle = effect.team === 'red' ? 'rgba(255, 100, 0, 0.3)' : 'rgba(0, 100, 255, 0.3)';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(effect.x, effect.y, effect.radius, 0, Math.PI * 2);
                    ctx.stroke();
                } else if (effect.type === 'shadow') {
                    const alpha = effect.alpha * (1 - (Date.now() - effect.startTime) / effect.duration);
                    ctx.globalAlpha = alpha;
                    ctx.fillStyle = effect.color;
                    ctx.beginPath();
                    ctx.arc(effect.x, effect.y, effect.radius, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.globalAlpha = 1.0;
                } else if (effect.type === 'fireSpecial') {
                    // Efeito especial do mago de fogo
                    const progress = (Date.now() - effect.startTime) / effect.duration;
                    const alpha = 0.7 * (1 - progress);
                    const radius = effect.radius * (1 + progress * 0.5);
                    
                    ctx.globalAlpha = alpha;
                    ctx.fillStyle = effect.team === 'red' ? 'rgba(255, 100, 0, 0.3)' : 'rgba(0, 100, 255, 0.3)';
                    ctx.beginPath();
                    ctx.arc(effect.x, effect.y, radius, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.globalAlpha = 1.0;
                } else if (effect.type === 'swordSpecial') {
                    // Efeito especial do cavaleiro
                    const progress = (Date.now() - effect.startTime) / effect.duration;
                    const alpha = 0.7 * (1 - progress);
                    const length = config.playerSize * 3;
                    const endX = effect.x + Math.cos(effect.angle) * length;
                    const endY = effect.y + Math.sin(effect.angle) * length;
                    
                    ctx.globalAlpha = alpha;
                    ctx.strokeStyle = '#800080';
                    ctx.lineWidth = 8;
                    ctx.beginPath();
                    ctx.moveTo(effect.x, effect.y);
                    ctx.lineTo(endX, endY);
                    ctx.stroke();
                    ctx.globalAlpha = 1.0;
                } else if (effect.type === 'necromancerSpecial') {
                    // Efeito especial do necromante
                    const progress = (Date.now() - effect.startTime) / effect.duration;
                    const alpha = 0.7 * (1 - progress);
                    const radius = effect.radius * (1 + progress * 0.5);
                    
                    ctx.globalAlpha = alpha;
                    ctx.fillStyle = 'rgba(128, 0, 128, 0.3)';
                    ctx.beginPath();
                    ctx.arc(effect.x, effect.y, radius, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.globalAlpha = 1.0;
                } else if (effect.type === 'lancerSpecial') {
                    // Efeito especial do lanceiro
                    const progress = (Date.now() - effect.startTime) / effect.duration;
                    const alpha = 0.7 * (1 - progress);
                    const length = config.playerSize * 4;
                    const endX = effect.x + Math.cos(effect.angle) * length;
                    const endY = effect.y + Math.sin(effect.angle) * length;
                    
                    ctx.globalAlpha = alpha;
                    ctx.strokeStyle = effect.team === 'red' ? 'rgba(255, 100, 0, 0.5)' : 'rgba(0, 100, 255, 0.5)';
                    ctx.lineWidth = 5;
                    ctx.beginPath();
                    ctx.moveTo(effect.x, effect.y);
                    ctx.lineTo(endX, endY);
                    ctx.stroke();
                    ctx.globalAlpha = 1.0;
                } else if (effect.type === 'assassinSpecial') {
                    // Efeito especial do assassino
                    const progress = (Date.now() - effect.startTime) / effect.duration;
                    const alpha = 0.7 * (1 - progress);
                    const radius = config.playerSize * 2;
                    
                    ctx.globalAlpha = alpha;
                    ctx.strokeStyle = effect.team === 'red' ? 'rgba(255, 100, 0, 0.5)' : 'rgba(0, 100, 255, 0.5)';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(effect.x, effect.y, radius, 0, Math.PI * 2);
                    ctx.stroke();
                    ctx.globalAlpha = 1.0;
                }
            }
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // Event listeners
        window.addEventListener('resize', resizeCanvas);
        
        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            
            // Teclas do jogador 1
            if (e.key === 't' && gameRunning && !gamePaused) {
                player1.shoot();
            }
            if (e.key === 'y' && gameRunning && !gamePaused) {
                player1.useSpecial();
            }
            if (e.key === 'g' && gameRunning && !gamePaused && player1.type === 'lancer') {
                player1.attack();
            }
            
            // Teclas do jogador 2
            if (e.key === 'l' && gameRunning && !gamePaused) {
                if (player2.type === 'lancer') {
                    player2.attack();
                } else {
                    player2.shoot();
                }
            }
            if (e.key === '√ß' && gameRunning && !gamePaused) {
                player2.useSpecial();
            }
        });
        
        window.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });
        
        startButton.addEventListener('click', () => {
            if (!player1Selected || !player2Selected) {
                alert('Ambos os jogadores devem selecionar um campe√£o!');
                return;
            }
            
            menu.style.display = 'none';
            gameUI.style.display = 'block';
            newMatch();
        });
        
        restartButton.addEventListener('click', () => {
            gameOverScreen.style.display = 'none';
            newMatch();
        });
        
        rematchButton.addEventListener('click', () => {
            victoryScreen.style.display = 'none';
            newMatch();
        });
        
        menuButton.addEventListener('click', () => {
            returnToMenu();
        });
        
        characterElements.forEach(el => {
            el.addEventListener('click', () => {
                const team = el.closest('.team').classList.contains('team-red') ? 'red' : 'blue';
                const character = el.dataset.character;
                
                if (team === 'red') {
                    // Deselecionar personagem anterior do time vermelho
                    document.querySelectorAll('.team-red .character').forEach(c => 
                        c.classList.remove('selected'));
                    player1Selected = character;
                } else {
                    // Deselecionar personagem anterior do time azul
                    document.querySelectorAll('.team-blue .character').forEach(c => 
                        c.classList.remove('selected'));
                    player2Selected = character;
                }
                
                el.classList.add('selected');
            });
        });

        // Inicializa√ß√£o
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            config.width = canvas.width;
            config.height = canvas.height;
        }

        resizeCanvas();
        gameUI.style.display = 'none';
        gameOverScreen.style.display = 'none';
        victoryScreen.style.display = 'none';
        roundWinner.style.display = 'none';
        gameLoop();
    </script>
</body>
</html><!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arena of Champions</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background-color: #222;
            color: white;
        }
        
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        #canvas {
            display: block;
            background-color: #111;
        }
        
        #menu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }
        
        #title {
            font-size: 48px;
            margin-bottom: 40px;
            color: #f0f0f0;
            text-shadow: 0 0 10px #fff;
        }
        
        .team-select {
            display: flex;
            gap: 50px;
            margin-bottom: 40px;
        }
        
        .team {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .team-title {
            font-size: 24px;
            margin-bottom: 20px;
        }
        
        .team-red .team-title {
            color: #f00;
        }
        
        .team-blue .team-title {
            color: #00f;
        }
        
        .character-select {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            max-width: 500px;
        }
        
        .character {
            width: 120px;
            height: 160px;
            background-color: #333;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .character:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px #555;
        }
        
        .character.selected {
            box-shadow: 0 0 20px currentColor;
        }
        
        .team-red .character.selected {
            border: 2px solid #f00;
            color: #f00;
        }
        
        .team-blue .character.selected {
            border: 2px solid #00f;
            color: #00f;
        }
        
        .character-icon {
            width: 70px;
            height: 70px;
            background-color: #555;
            border-radius: 50%;
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
        }
        
        .character-name {
            font-size: 16px;
            margin-bottom: 5px;
            text-align: center;
        }
        
        .character-desc {
            font-size: 10px;
            text-align: center;
            color: #aaa;
        }
        
        #startButton {
            padding: 15px 40px;
            font-size: 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        #startButton:hover {
            background-color: #45a049;
            transform: scale(1.05);
        }
        
        #gameUI {
            position: absolute;
            top: 10px;
            left: 0;
            right: 0;
            color: white;
            font-size: 18px;
            z-index: 5;
            display: none;
        }
        
        .health-bar {
            width: 200px;
            height: 20px;
            background-color: #333;
            border: 2px solid #555;
            margin-bottom: 5px;
            position: relative;
        }
        
        .health-fill {
            height: 100%;
            width: 100%;
            background-color: #f00;
            transition: width 0.3s;
        }
        
        .team-red .health-fill {
            background-color: #f00;
        }
        
        .team-blue .health-fill {
            background-color: #00f;
        }
        
        .special-bar {
            width: 200px;
            height: 15px;
            background-color: #333;
            border: 2px solid #555;
            margin-top: 10px;
        }
        
        .special-fill {
            height: 100%;
            width: 0%;
            background-color: #00f;
            transition: width 0.3s;
        }
        
        .basic-attack-bar {
            width: 200px;
            height: 10px;
            background-color: #333;
            border: 2px solid #555;
            margin-top: 5px;
        }
        
        .basic-attack-fill {
            height: 100%;
            width: 0%;
            background-color: #0f0;
            transition: width 0.3s;
        }
        
        .player-info {
            position: absolute;
            top: 10px;
            width: 220px;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 5px;
        }
        
        #player1Info {
            left: 10px;
            border-left: 3px solid #f00;
        }
        
        #player2Info {
            right: 10px;
            border-right: 3px solid #00f;
        }
        
        .player-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        #gameOver {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
        }
        
        #gameOver h1 {
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        #winnerText {
            font-size: 36px;
            margin-bottom: 30px;
        }
        
        #restartButton {
            padding: 15px 40px;
            font-size: 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        #restartButton:hover {
            background-color: #45a049;
            transform: scale(1.05);
        }
        
        #menuButton {
            padding: 15px 40px;
            font-size: 20px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }
        
        #menuButton:hover {
            background-color: #d32f2f;
            transform: scale(1.05);
        }
        
        .instructions {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: #aaa;
            font-size: 14px;
            text-align: center;
            width: 100%;
        }
        
        .controls {
            margin-top: 10px;
            font-size: 12px;
            color: #ccc;
        }
        
        #scoreDisplay {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            color: white;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px 24px;
            border-radius: 5px;
            z-index: 5;
        }
        
        #roundWinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            color: white;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 20px 40px;
            border-radius: 10px;
            z-index: 15;
            display: none;
        }
        
        #victoryScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 25;
        }
        
        #victoryText {
            font-size: 72px;
            margin-bottom: 40px;
            color: gold;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
        }
        
        #victoryButtons {
            display: flex;
            gap: 20px;
        }

        .face {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .fireMage-face {
            background-color: #f80;
            border: 2px solid #f50;
        }

        .archer-face {
            background-color: #0a0;
            border: 2px solid #080;
        }

        .knight-face {
            background-color: #300;
            border: 2px solid #100;
        }

        .necromancer-face {
            background-color: #808;
            border: 2px solid #606;
        }

        .lancer-face {
            background-color: #0ff;
            border: 2px solid #0cc;
        }

        .assassin-face {
            background-color: #840;
            border: 2px solid #620;
        }

        .aim-arrow {
            position: absolute;
            width: 15px;
            height: 15px;
            background-color: white;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            transform-origin: 50% 100%;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="canvas"></canvas>
        
        <div id="gameUI">
            <div id="player1Info" class="player-info team-red">
                <div class="player-name">Jogador 1</div>
                <div class="health-bar">
                    <div class="health-fill"></div>
                </div>
                <div class="special-bar">
                    <div class="special-fill"></div>
                </div>
                <div class="basic-attack-bar">
                    <div class="basic-attack-fill"></div>
                </div>
                <div class="controls">WASD - Movimento | T - Atirar | Y - Especial</div>
            </div>
            
            <div id="player2Info" class="player-info team-blue">
                <div class="player-name">Jogador 2</div>
                <div class="health-bar">
                    <div class="health-fill"></div>
                </div>
                <div class="special-bar">
                    <div class="special-fill"></div>
                </div>
                <div class="basic-attack-bar">
                    <div class="basic-attack-fill"></div>
                </div>
                <div class="controls">Setas - Movimento | L - Atirar | √á - Especial</div>
            </div>
            
            <div id="scoreDisplay">Vermelho 0 - 0 Azul</div>
        </div>
        
        <div id="menu">
            <h1 id="title">Arena of Champions</h1>
            
            <div class="team-select">
                <div class="team team-red">
                    <div class="team-title">Time Vermelho (Jogador 1)</div>
                    <div class="character-select">
                        <div class="character" data-character="fireMage">
                            <div class="character-icon">üî•</div>
                            <div class="character-name">Mago de Fogo</div>
                            <div class="character-desc">Atira bolas de fogo que causam queimadura. Especial: Explos√£o de fogo.</div>
                        </div>
                        <div class="character" data-character="archer">
                            <div class="character-icon">üèπ</div>
                            <div class="character-name">Arqueiro Real</div>
                            <div class="character-desc">Atira flechas rapidamente. Especial: Chuva de flechas.</div>
                        </div>
                        <div class="character" data-character="knight">
                            <div class="character-icon">‚öîÔ∏è</div>
                            <div class="character-name">Cavaleiro Negro</div>
                            <div class="character-desc">Atira tr√™s proj√©teis de uma vez. Especial: Espada poderosa.</div>
                        </div>
                        <div class="character" data-character="necromancer">
                            <div class="character-icon">üíÄ</div>
                            <div class="character-name">Necromante</div>
                            <div class="character-desc">Invoca criaturas dos mortos. Especial: Invoca√ß√£o dos Mortos.</div>
                        </div>
                        <div class="character" data-character="lancer">
                            <div class="character-icon">üî±</div>
                            <div class="character-name">Lanceiro</div>
                            <div class="character-desc">Ataques corpo-a-corpo poderosos. Especial: Investida Real.</div>
                        </div>
                        <div class="character" data-character="assassin">
                            <div class="character-icon">üó°Ô∏è</div>
                            <div class="character-name">Assassino</div>
                            <div class="character-desc">Ataques r√°pidos e furtivos. Especial: Desaparecimento Letal.</div>
                        </div>
                    </div>
                </div>
                
                <div class="team team-blue">
                    <div class="team-title">Time Azul (Jogador 2)</div>
                    <div class="character-select">
                        <div class="character" data-character="fireMage">
                            <div class="character-icon">üî•</div>
                            <div class="character-name">Mago de Fogo</div>
                            <div class="character-desc">Atira bolas de fogo que causam queimadura. Especial: Explos√£o de fogo.</div>
                        </div>
                        <div class="character" data-character="archer">
                            <div class="character-icon">üèπ</div>
                            <div class="character-name">Arqueiro Real</div>
                            <div class="character-desc">Atira flechas rapidamente. Especial: Chuva de flechas.</div>
                        </div>
                        <div class="character" data-character="knight">
                            <div class="character-icon">‚öîÔ∏è</div>
                            <div class="character-name">Cavaleiro Negro</div>
                            <div class="character-desc">Atira tr√™s proj√©teis de uma vez. Especial: Espada poderosa.</div>
                        </div>
                        <div class="character" data-character="necromancer">
                            <div class="character-icon">üíÄ</div>
                            <div class="character-name">Necromante</div>
                            <div class="character-desc">Invoca criaturas dos mortos. Especial: Invoca√ß√£o dos Mortos.</div>
                        </div>
                        <div class="character" data-character="lancer">
                            <div class="character-icon">üî±</div>
                            <div class="character-name">Lanceiro</div>
                            <div class="character-desc">Ataques corpo-a-corpo poderosos. Especial: Investida Real.</div>
                        </div>
                        <div class="character" data-character="assassin">
                            <div class="character-icon">üó°Ô∏è</div>
                            <div class="character-name">Assassino</div>
                            <div class="character-desc">Ataques r√°pidos e furtivos. Especial: Desaparecimento Letal.</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <button id="startButton">Come√ßar Batalha</button>
         
        </div>
        
        <div id="gameOver">
            <h1>Fim da Batalha</h1>
            <div id="winnerText"></div>
            <button id="restartButton">Jogar Novamente</button>
        </div>
        
        <div id="roundWinner"></div>
        
        <div id="victoryScreen">
            <div id="victoryText"></div>
            <div id="victoryButtons">
                <button id="rematchButton">Revanche</button>
                <button id="menuButton">Menu</button>
            </div>
        </div>
    </div>

    <script>
        // Configura√ß√µes do jogo
        const config = {
            width: 800,
            height: 600,
            playerSpeed: 5,
            playerSize: 20,
            powerUpSpawnRate: 15000, // 15 segundos
            specialCooldown: {
                fireMage: 15000,
                archer: 15000,
                knight: 20000,
                necromancer: 20000,
                lancer: 17000,
                assassin: 15000
            },
            basicAttackCooldown: {
                fireMage: 700,
                archer: 250,
                knight: 550,
                necromancer: 650,
                lancer: 1000,
                assassin: 300
            }
        };

        // Elementos do DOM
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const menu = document.getElementById('menu');
        const gameUI = document.getElementById('gameUI');
        const player1Info = document.getElementById('player1Info');
        const player2Info = document.getElementById('player2Info');
        const gameOverScreen = document.getElementById('gameOver');
        const winnerText = document.getElementById('winnerText');
        const startButton = document.getElementById('startButton');
        const restartButton = document.getElementById('restartButton');
        const characterElements = document.querySelectorAll('.character');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const roundWinner = document.getElementById('roundWinner');
        const victoryScreen = document.getElementById('victoryScreen');
        const victoryText = document.getElementById('victoryText');
        const rematchButton = document.getElementById('rematchButton');
        const menuButton = document.getElementById('menuButton');

        // Estado do jogo
        let gameRunning = false;
        let gamePaused = false;
        let player1 = null;
        let player2 = null;
        let projectiles = [];
        let monsters = [];
        let effects = [];
        let powerUps = [];
        let lastPowerUpSpawn = 0;
        let keys = {};
        let player1Selected = null;
        let player2Selected = null;
        let gameTime = 0;
        let score = { red: 0, blue: 0 };
        let roundEndTime = 0;
        let roundWinnerTeam = null;
        let lastDirection = {
            red: { x: 1, y: 0 },
            blue: { x: -1, y: 0 }
        };

        // Cores dos personagens
        const characterColors = {
            fireMage: '#f80',    // Laranja
            archer: '#0a0',     // Verde
            knight: '#300',     // Preto
            necromancer: '#808', // Roxo
            lancer: '#0ff',     // Azul ciano
            assassin: '#840'     // Marrom
        };

        // Classes do jogo
        class Player {
            constructor(type, team, x, y) {
                this.type = type;
                this.team = team;
                this.x = x;
                this.y = y;
                this.size = config.playerSize;
                this.speed = config.playerSpeed;
                this.color = characterColors[type];
                this.bulletSpeed = 10;
                this.bulletSize = 8;
                this.bulletColor = team === 'red' ? '#f80' : '#0af';
                this.lastShotTime = 0;
                this.shotInterval = config.basicAttackCooldown[type];
                this.specialCooldown = config.specialCooldown[type];
                this.specialReady = true;
                this.specialActive = false;
                this.specialEndTime = 0;
                this.damage = 0;
                this.maxHealth = 100;
                this.health = this.maxHealth;
                this.invulnerable = false;
                this.swordAngle = 0;
                this.attackCooldown = 0;
                this.lastAttackTime = 0;
                this.attacking = false;
                this.attackDuration = 200;
                this.stunnedUntil = 0;
                this.visible = true;
                this.lastBasicAttackTime = 0;
                this.basicAttackReady = true;
                this.aimAngle = team === 'red' ? 0 : Math.PI;
                this.faceElement = document.createElement('div');
                this.faceElement.className = `face ${type}-face`;
                document.body.appendChild(this.faceElement);
                this.aimArrow = document.createElement('div');
                this.aimArrow.className = 'aim-arrow';
                document.body.appendChild(this.aimArrow);
                
                // Configura√ß√µes espec√≠ficas por personagem
                switch(type) {
                    case 'fireMage':
                        this.color = characterColors.fireMage;
                        this.bulletColor = team === 'red' ? '#f80' : '#0af';
                        this.bulletSize = 10;
                        this.shotInterval = 700;
                        this.damage = 15;
                        this.maxHealth = 250;
                        this.health = 250;
                        break;
                    case 'archer':
                        this.color = characterColors.archer;
                        this.bulletColor = team === 'red' ? '#f00' : '#00f';
                        this.bulletSize = 6;
                        this.shotInterval = 250;
                        this.damage = 15;
                        this.maxHealth = 215;
                        this.health = 215;
                        this.speed = config.playerSpeed * 1.3;
                        break;
                    case 'knight':
                        this.color = characterColors.knight;
                        this.bulletColor = team === 'red' ? '#a00' : '#00a';
                        this.bulletSize = 7;
                        this.shotInterval = 550;
                        this.damage = 27;
                        this.maxHealth = 325;
                        this.health = 325;
                        this.bulletRange = 200;
                        break;
                    case 'necromancer':
                        this.color = characterColors.necromancer;
                        this.bulletColor = team === 'red' ? '#a00' : '#00a';
                        this.bulletSize = 10;
                        this.shotInterval = 650;
                        this.damage = 45;
                        this.maxHealth = 250;
                        this.health = 250;
                        break;
                    case 'lancer':
                        this.color = characterColors.lancer;
                        this.speed = config.playerSpeed * 1.15;
                        this.attackCooldown = 900;
                        this.lastAttackTime = 0;
                        this.attacking = false;
                        this.attackDuration = 200;
                        this.damage = 55;
                        this.maxHealth = 350;
                        this.health = 350;
                        break;
                    case 'assassin':
                        this.color = characterColors.assassin;
                        this.bulletColor = team === 'red' ? '#a00' : '#00a';
                        this.bulletSize = 5;
                        this.shotInterval = 300;
                        this.damage = 45;
                        this.maxHealth = 220;
                        this.health = 220;
                        this.speed = config.playerSpeed * 1.3;
                        break;
                }
            }
            
            update() {
                if (this.stunnedUntil > Date.now() || gamePaused) return;
                
                // Atualizar cooldown do ataque b√°sico
                if (!this.basicAttackReady) {
                    const elapsed = Date.now() - this.lastBasicAttackTime;
                    const percent = (elapsed / this.shotInterval) * 100;
                    this.updateBasicAttackBar(percent);
                    
                    if (elapsed >= this.shotInterval) {
                        this.basicAttackReady = true;
                        this.updateBasicAttackBar(100);
                    }
                }
                
                // Movimento
                let moveX = 0;
                let moveY = 0;
                
                if (this.team === 'red') {
                    if (keys['w']) moveY -= this.speed;
                    if (keys['s']) moveY += this.speed;
                    if (keys['a']) moveX -= this.speed;
                    if (keys['d']) moveX += this.speed;
                } else {
                    if (keys['ArrowUp']) moveY -= this.speed;
                    if (keys['ArrowDown']) moveY += this.speed;
                    if (keys['ArrowLeft']) moveX -= this.speed;
                    if (keys['ArrowRight']) moveX += this.speed;
                }
                
                // Atualizar dire√ß√£o da mira
                if (moveX !== 0 || moveY !== 0) {
                    this.aimAngle = Math.atan2(moveY, moveX);
                    lastDirection[this.team] = { x: moveX, y: moveY };
                } else {
                    // Manter a √∫ltima dire√ß√£o se n√£o estiver se movendo
                    const lastDir = lastDirection[this.team];
                    if (lastDir.x !== 0 || lastDir.y !== 0) {
                        this.aimAngle = Math.atan2(lastDir.y, lastDir.x);
                    }
                }
                
                // Normalizar movimento diagonal
                if (moveX !== 0 && moveY !== 0) {
                    moveX *= 0.7071; // 1/sqrt(2)
                    moveY *= 0.7071;
                }
                
                this.x += moveX;
                this.y += moveY;
                
                // Limitar ao canvas (com borda vermelha)
                const borderSize = 10;
                this.x = Math.max(this.size + borderSize, Math.min(config.width - this.size - borderSize, this.x));
                this.y = Math.max(this.size + borderSize, Math.min(config.height - this.size - borderSize, this.y));
                
                // Atualizar posi√ß√£o do rosto e seta de mira
                this.faceElement.style.left = `${this.x + window.scrollX - 25}px`;
                this.faceElement.style.top = `${this.y + window.scrollY - 25}px`;
                this.aimArrow.style.left = `${this.x + window.scrollX + Math.cos(this.aimAngle) * (this.size + 10) - 7}px`;
                this.aimArrow.style.top = `${this.y + window.scrollY + Math.sin(this.aimAngle) * (this.size + 10) - 7}px`;
                this.aimArrow.style.transform = `rotate(${this.aimAngle}rad)`;
                
                // Verificar se habilidade especial est√° ativa
                if (this.specialActive && Date.now() > this.specialEndTime) {
                    this.specialActive = false;
                    
                    if (this.type === 'archer') {
                        this.speed = config.playerSpeed;
                    } else if (this.type === 'knight') {
                        this.invulnerable = false;
                        this.speed = config.playerSpeed;
                    } else if (this.type === 'lancer') {
                        this.invulnerable = false;
                        this.speed = config.playerSpeed * 1.15;
                    } else if (this.type === 'assassin') {
                        this.visible = true;
                        this.speed = config.playerSpeed * 1.3;
                    }
                }
                
                // Atualizar √¢ngulo da espada do cavaleiro ou lan√ßa do lanceiro
                if (this.type === 'knight' || this.type === 'lancer') {
                    this.swordAngle = this.aimAngle;
                }
                
                // Verificar se est√° atacando (lanceiro)
                if (this.type === 'lancer' && this.attacking && Date.now() > this.lastAttackTime + this.attackDuration) {
                    this.attacking = false;
                }
            }
            
            draw() {
                if (!this.visible) return;
                
                // Desenhar jogador com transpar√™ncia se estiver invulner√°vel ou invis√≠vel
                if (this.invulnerable || (this.type === 'assassin' && this.specialActive)) {
                    ctx.globalAlpha = 0.6;
                }
                
                // Desenhar jogador atordoado
                if (this.stunnedUntil > Date.now()) {
                    ctx.fillStyle = '#888';
                } else {
                    ctx.fillStyle = this.color;
                }
                
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                
                // Resetar transpar√™ncia
                ctx.globalAlpha = 1.0;
                
                // Desenhar aura se for mago de fogo com especial ativo
                if (this.type === 'fireMage' && this.specialActive) {
                    ctx.strokeStyle = this.team === 'red' ? 'rgba(255, 100, 0, 0.5)' : 'rgba(0, 100, 255, 0.5)';
                    ctx.lineWidth = 10;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size + 30, 0, Math.PI * 2);
                    ctx.stroke();
                }
                
                // Desenhar espada se for cavaleiro com especial ativo
                if (this.type === 'knight' && this.specialActive) {
                    const swordLength = this.size * 2;
                    const swordEndX = this.x + Math.cos(this.swordAngle) * swordLength;
                    const swordEndY = this.y + Math.sin(this.swordAngle) * swordLength;
                    
                    // L√¢mina da espada (cinza)
                    ctx.strokeStyle = '#ccc';
                    ctx.lineWidth = 5;
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y);
                    ctx.lineTo(swordEndX, swordEndY);
                    ctx.stroke();
                    
                    // Base da espada (marrom)
                    ctx.strokeStyle = '#840';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y);
                    ctx.lineTo(this.x + Math.cos(this.swordAngle) * this.size * 0.7, this.y + Math.sin(this.swordAngle) * this.size * 0.7);
                    ctx.stroke();
                    
                    // Ponta da espada
                    ctx.fillStyle = '#ccc';
                    ctx.beginPath();
                    ctx.arc(swordEndX, swordEndY, 5, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Desenhar lan√ßa do lanceiro
                if (this.type === 'lancer') {
                    const lanceLength = this.size * 2.3;
                    const lanceEndX = this.x + Math.cos(this.swordAngle) * lanceLength;
                    const lanceEndY = this.y + Math.sin(this.swordAngle) * lanceLength;
                    
                    // Cor da lan√ßa muda quando est√° atacando
                    const lanceTipColor = this.attacking ? '#f00' : '#fff';
                    
                    // Haste da lan√ßa (marrom)
                    ctx.strokeStyle = '#840';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y);
                    ctx.lineTo(lanceEndX, lanceEndY);
                    ctx.stroke();
                    
                    // Ponta da lan√ßa (branca ou vermelha)
                    ctx.fillStyle = lanceTipColor;
                    ctx.beginPath();
                    ctx.arc(lanceEndX, lanceEndY, 3, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Desenhar nome do personagem
                ctx.fillStyle = '#fff';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(this.type === 'fireMage' ? 'üî•' : 
                            this.type === 'archer' ? 'üèπ' : 
                            this.type === 'knight' ? '‚öîÔ∏è' :
                            this.type === 'necromancer' ? '‚ò†Ô∏è' :
                            this.type === 'lancer' ? 'üî±' : 'üó°Ô∏è', 
                            this.x, this.y - this.size - 5);
              
            }
            
            shoot() {
                // Verificar se pode atirar (intervalo e se n√£o est√° atordoado)
                const now = Date.now();
                if (!this.basicAttackReady || 
                    this.stunnedUntil > now ||
                    (this.type === 'knight' && this.specialActive) ||
                    this.type === 'lancer' ||
                    gamePaused) {
                    return;
                }
                
                this.lastBasicAttackTime = now;
                this.basicAttackReady = false;
                this.updateBasicAttackBar(0);
                
                // Usar √¢ngulo de mira atual
                const angle = this.aimAngle;
                
                switch(this.type) {
                    case 'fireMage':
                        // Mago atira dois proj√©teis um atr√°s do outro com delay
                        const offset = 15;
                        const bullet1 = new Bullet(
                            this.x + Math.cos(angle) * offset,
                            this.y + Math.sin(angle) * offset,
                            angle,
                            this.bulletSpeed,
                            this.bulletSize,
                            this.bulletColor,
                            this.damage,
                            this.team,
                            'burn',
                            { damage: 3, duration: 3000 }
                        );
                        
                        projectiles.push(bullet1);
                        
                        // Segundo projetil com delay
                        setTimeout(() => {
                            if (gameRunning && !gamePaused) {
                                const bullet2 = new Bullet(
                                    this.x + Math.cos(angle) * offset,
                                    this.y + Math.sin(angle) * offset,
                                    angle,
                                    this.bulletSpeed,
                                    this.bulletSize,
                                    this.bulletColor,
                                    this.damage,
                                    this.team
                                );
                                projectiles.push(bullet2);
                            }
                        }, 100);
                        break;
                        
                    case 'archer':
                        // Arqueiro atira uma flecha
                        const arrow = new Bullet(
                            this.x,
                            this.y,
                            angle,
                            this.bulletSpeed * 1.3,
                            this.bulletSize,
                            this.bulletColor,
                            this.damage,
                            this.team
                        );
                        projectiles.push(arrow);
                        break;
                        
                    case 'knight':
                        // Cavaleiro atira tr√™s balas em leque com alcance curto
                        for (let i = -1; i <= 1; i++) {
                            const spreadAngle = angle + (i * 0.2);
                            const bullet = new Bullet(
                                this.x,
                                this.y,
                                spreadAngle,
                                this.bulletSpeed,
                                this.bulletSize,
                                this.bulletColor,
                                this.damage,
                                this.team,
                                null,
                                null,
                                this.bulletRange
                            );
                            projectiles.push(bullet);
                        }
                        break;
                        
                    case 'necromancer':
                        // Necromante atira uma esfera que se divide
                        const orb = new Bullet(
                            this.x,
                            this.y,
                            angle,
                            this.bulletSpeed * 1.1,
                            this.bulletSize,
                            this.bulletColor,
                            this.damage,
                            this.team,
                            'split',
                            { count: 3, damage: 15, angleSpread: 0.3 }
                        );
                        projectiles.push(orb);
                        break;
                        
                    case 'assassin':
                        // Assassino d√° um dash e atira uma faca
                        const dashDistance = 30;
                        this.x += Math.cos(angle) * dashDistance;
                        this.y += Math.sin(angle) * dashDistance;
                        
                        // Limitar ao canvas (com borda vermelha)
                        const borderSize = 10;
                        this.x = Math.max(this.size + borderSize, Math.min(config.width - this.size - borderSize, this.x));
                        this.y = Math.max(this.size + borderSize, Math.min(config.height - this.size - borderSize, this.y));
                        
                        const dagger = new Bullet(
                            this.x,
                            this.y,
                            angle,
                            this.bulletSpeed * 1.8,
                            this.bulletSize,
                            this.bulletColor,
                            this.damage,
                            this.team,
                            'bleed',
                            { damage: 7, duration: 2000 }
                        );
                        projectiles.push(dagger);
                        
                        // Cooldown maior se acertar o oponente
                        const opponent = this.team === 'red' ? player2 : player1;
                        const distance = Math.sqrt(
                            Math.pow(opponent.x - this.x, 2) + 
                            Math.pow(opponent.y - this.y, 2)
                        );
                        
                        if (distance < opponent.size + this.size + 20) {
                            this.shotInterval = 1500;
                        } else {
                            this.shotInterval = 300;
                        }
                        break;
                }
            }
            
            attack() {
                // Ataque do lanceiro
                if (this.type !== 'lancer') return;
                
                const now = Date.now();
                if (now - this.lastAttackTime < this.attackCooldown || this.stunnedUntil > now || gamePaused) {
                    return;
                }
                
                this.lastAttackTime = now;
                this.attacking = true;
                
                // Verificar colis√£o com o oponente
                const opponent = this.team === 'red' ? player2 : player1;
                const lanceLength = this.size * 2.5;
                const lanceEndX = this.x + Math.cos(this.swordAngle) * lanceLength;
                const lanceEndY = this.y + Math.sin(this.swordAngle) * lanceLength;
                
                if (checkLineCircleCollision(
                    this.x, this.y, lanceEndX, lanceEndY,
                    opponent.x, opponent.y, opponent.size
                )) {
                    opponent.takeDamage(this.damage);
                }
            }
            
            useSpecial() {
                if (!this.specialReady || this.specialActive || this.stunnedUntil > Date.now() || gamePaused) return;
                
                this.specialReady = false;
                this.specialActive = true;
                this.updateSpecialBar(0);
                
                switch(this.type) {
                    case 'fireMage':
                        // Criar 50 bolas de fogo em todas as dire√ß√µes
                        for (let i = 0; i < 50; i++) {
                            const angle = (i / 50) * Math.PI * 2;
                            const bullet = new Bullet(
                                this.x,
                                this.y,
                                angle,
                                this.bulletSpeed * 1.3,
                                this.bulletSize * 1.5,
                                this.team === 'red' ? '#f50' : '#05f',
                                20,
                                this.team,
                                'burn',
                                { damage: 10, duration: 3000 }
                            );
                            projectiles.push(bullet);
                        }
                        
                        // Adicionar efeito de aura
                        effects.push({
                            x: this.x,
                            y: this.y,
                            radius: this.size + 30,
                            damage: 5,
                            interval: 500,
                            lastHitTime: 0,
                            duration: 3000,
                            startTime: Date.now(),
                            type: 'aura',
                            team: this.team
                        });
                        
                        // Efeito especial de fogo
                        effects.push({
                            x: this.x,
                            y: this.y,
                            radius: this.size + 50,
                            duration: 3000,
                            startTime: Date.now(),
                            type: 'fireSpecial',
                            team: this.team
                        });
                        
                        this.specialEndTime = Date.now();
                        break;
                        
                    case 'archer':
                        // Atirar 25 flechas na dire√ß√£o do oponente
                        const angle = this.aimAngle;
                        for (let i = 0; i < 25; i++) {
                            const spreadAngle = angle + (Math.random() - 0.5) * 0.5;
                            const arrow = new Bullet(
                                this.x,
                                this.y,
                                spreadAngle,
                                this.bulletSpeed * 1.5,
                                this.bulletSize,
                                this.bulletColor,
                                10,
                                this.team
                            );
                            projectiles.push(arrow);
                        }
                        
                        // Dash para tr√°s
                        const dashAngle = angle + Math.PI;
                        this.x += Math.cos(dashAngle) * 100;
                        this.y += Math.sin(dashAngle) * 100;
                        
                        // Limitar ao canvas (com borda vermelha)
                        const borderSize = 10;
                        this.x = Math.max(this.size + borderSize, Math.min(config.width - this.size - borderSize, this.x));
                        this.y = Math.max(this.size + borderSize, Math.min(config.height - this.size - borderSize, this.y));
                        
                        // Efeito de sombra
                        effects.push({
                            x: this.x - Math.cos(dashAngle) * 50,
                            y: this.y - Math.sin(dashAngle) * 50,
                            radius: this.size,
                            alpha: 0.7,
                            duration: 1000,
                            startTime: Date.now(),
                            type: 'shadow',
                            color: this.color
                        });
                        
                        this.specialEndTime = Date.now();
                        break;
                        
                    case 'knight':
                        // Ativar modo espada e invulnerabilidade
                        this.invulnerable = true;
                        this.speed = config.playerSpeed * 1.3;
                        this.specialEndTime = Date.now() + 3000; 
                        
                        // Efeito de espada
                        setInterval(() => {
                            if (!this.specialActive) return;
                            
                            const swordLength = this.size * 2.5;
                            const swordEndX = this.x + Math.cos(this.swordAngle) * swordLength;
                            const swordEndY = this.y + Math.sin(this.swordAngle) * swordLength;
                            
                            const target = this.team === 'red' ? player2 : player1;
                            if (checkLineCircleCollision(
                                this.x, this.y, swordEndX, swordEndY,
                                target.x, target.y, target.size
                            )) {
                                target.takeDamage(10);
                            }
                        }, 780);
                        
                        // Efeito especial de espada
                        effects.push({
                            x: this.x,
                            y: this.y,
                            angle: this.swordAngle,
                            duration: 3000,
                            startTime: Date.now(),
                            type: 'swordSpecial',
                            team: this.team
                        });
                        break;
                        
                    case 'necromancer':
                        // Invocar 3 monstros (30% de chance do terceiro ser venenoso)
                        for (let i = 0; i < 3; i++) {
                            const isPoison = i === 2 && Math.random() < 0.3;
                            
                            const monster = new Monster(
                                this.x + (Math.random() - 0.5) * 50,
                                this.y + (Math.random() - 0.5) * 50,
                                this.team,
                                isPoison
                            );
                            monsters.push(monster);
                        }
                        
                        // Efeito especial de necromante
                        effects.push({
                            x: this.x,
                            y: this.y,
                            radius: this.size + 40,
                            duration: 1500,
                            startTime: Date.now(),
                            type: 'necromancerSpecial',
                            team: this.team
                        });
                        
                        this.specialEndTime = Date.now();
                        break;
                        
                    case 'lancer':
                        // Investida violenta
                        this.invulnerable = true;
                        this.speed = config.playerSpeed * 2.5;
                        this.specialEndTime = Date.now() + 2000; // 1 segundo de investida
                        
                        // Verificar colis√£o durante a investida
                        const checkCollision = setInterval(() => {
                            if (!this.specialActive) {
                                clearInterval(checkCollision);
                                return;
                            }
                            
                            const opponent = this.team === 'red' ? player2 : player1;
                            const distance = Math.sqrt(
                                Math.pow(this.x - opponent.x, 2) + 
                                Math.pow(this.y - opponent.y, 2)
                            );
                            
                            if (distance < this.size + opponent.size) {
                                // Acertou o oponente
                                opponent.takeDamage(100);
                                opponent.stunnedUntil = Date.now() + 2500; // 2.5 segundos de atordoamento
                                this.specialActive = false;
                                this.invulnerable = false;
                                this.speed = config.playerSpeed * 1.15;
                                clearInterval(checkCollision);
                            }
                            
                            // Verificar colis√£o com borda
                            const borderSize = 10;
                            if (this.x <= this.size + borderSize || 
                                this.x >= config.width - this.size - borderSize ||
                                this.y <= this.size + borderSize || 
                                this.y >= config.height - this.size - borderSize) {
                                this.specialActive = false;
                                this.invulnerable = false;
                                this.speed = config.playerSpeed * 1.15;
                                clearInterval(checkCollision);
                            }
                        }, 50);
                        
                        // Efeito especial de investida
                        effects.push({
                            x: this.x,
                            y: this.y,
                            angle: this.swordAngle,
                            duration: 2000,
                            startTime: Date.now(),
                            type: 'lancerSpecial',
                            team: this.team
                        });
                        break;
                        
                    case 'assassin':
                        // Invisibilidade e velocidade aumentada
                        this.visible = false;
                        this.speed = config.playerSpeed * 2; // 100% mais r√°pido
                        this.specialEndTime = Date.now() + 2400; // 4 segundos
                        
                        // Atirar 3 adagas envenenadas em dire√ß√µes aleat√≥rias
                        for (let i = 0; i < 5; i++) {
                            const angle = Math.random() * Math.PI * 2;
                            const dagger = new Bullet(
                                this.x,
                                this.y,
                                angle,
                                this.bulletSpeed * 1.5,
                                this.bulletSize,
                                this.bulletColor,
                                10,
                                this.team,
                                'poison',
                                { damage: 5, duration: 5000, slow: 0.25 }
                            );
                            projectiles.push(dagger);
                        }
                        
                        // Efeito especial de assassin
                        effects.push({
                            x: this.x,
                            y: this.y,
                            duration: 2400,
                            startTime: Date.now(),
                            type: 'assassinSpecial',
                            team: this.team
                        });
                        break;
                }
                
                // Iniciar cooldown
                setTimeout(() => {
                    this.specialReady = true;
                    this.updateSpecialBar(100);
                }, this.specialCooldown);
            }
            
            takeDamage(amount) {
                if (this.invulnerable || this.stunnedUntil > Date.now()) return;
                
                this.health -= amount;
                this.updateHealthBar();
                
                if (this.health <= 0) {
                    // Ponto vai para o time que foi morto (inverso)
                    roundOver(this.team === 'red' ? 'blue' : 'red');
                }
            }
            
            heal(amount) {
                this.health = Math.min(this.maxHealth, this.health + amount);
                this.updateHealthBar();
            }
            
            updateHealthBar() {
                const healthBar = this.team === 'red' ? 
                    player1Info.querySelector('.health-fill') : 
                    player2Info.querySelector('.health-fill');
                healthBar.style.width = `${(this.health / this.maxHealth) * 100}%`;
            }
            
            updateSpecialBar(percent) {
                const specialBar = this.team === 'red' ? 
                    player1Info.querySelector('.special-fill') : 
                    player2Info.querySelector('.special-fill');
                specialBar.style.width = `${percent}%`;
            }
            
            updateBasicAttackBar(percent) {
                const basicAttackBar = this.team === 'red' ? 
                    player1Info.querySelector('.basic-attack-fill') : 
                    player2Info.querySelector('.basic-attack-fill');
                basicAttackBar.style.width = `${percent}%`;
            }
            
            destroy() {
                // Remover elementos DOM quando o jogador for destru√≠do
                if (this.faceElement.parentNode) {
                    this.faceElement.parentNode.removeChild(this.faceElement);
                }
                if (this.aimArrow.parentNode) {
                    this.aimArrow.parentNode.removeChild(this.aimArrow);
                }
            }
        }

        class Bullet {
            constructor(x, y, angle, speed, size, color, damage, team, effectType = null, effectData = null, range = null) {
                this.x = x;
                this.y = y;
                this.angle = angle;
                this.speed = speed;
                this.size = size;
                this.color = color;
                this.damage = damage;
                this.team = team;
                this.effectType = effectType;
                this.effectData = effectData;
                this.range = range;
                this.distanceTraveled = 0;
                this.startX = x;
                this.startY = y;
                this.shouldSplit = false;
                
                if (effectType === 'split') {
                    this.splitDistance = this.range ? this.range / 2 : 300;
                }
            }
            
            update() {
                this.x += Math.cos(this.angle) * this.speed;
                this.y += Math.sin(this.angle) * this.speed;
                this.distanceTraveled = Math.sqrt((this.x - this.startX) ** 2 + (this.y - this.startY) ** 2);
                
                // Verificar divis√£o do projetil (necromante)
                if (this.effectType === 'split' && !this.shouldSplit && 
                    this.distanceTraveled >= this.splitDistance) {
                    this.shouldSplit = true;
                    this.split();
                    return true; // Remove o projetil original ap√≥s a divis√£o
                }
                
                // Verificar se saiu da tela ou atingiu o alcance m√°ximo
                return this.x < -this.size || this.x > config.width + this.size || 
                       this.y < -this.size || this.y > config.height + this.size ||
                       (this.range !== null && this.distanceTraveled >= this.range);
            }
            
            split() {
                if (this.effectType !== 'split') return;
                
                for (let i = -1; i <= 1; i++) {
                    const spreadAngle = this.angle + (i * this.effectData.angleSpread);
                    const bullet = new Bullet(
                        this.x,
                        this.y,
                        spreadAngle,
                        this.speed * 0.9,
                        this.size * 0.8,
                        this.color,
                        this.effectData.damage,
                        this.team
                    );
                    projectiles.push(bullet);
                }
            }
            
            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        class Monster {
            constructor(x, y, team, isPoison = false) {
                this.x = x;
                this.y = y;
                this.size = 12;
                this.speed = 2;
                this.team = team;
                this.color = isPoison ? '#0a0' : (team === 'red' ? '#a00' : '#00a');
                this.health = isPoison ? 45 : 65;
                this.maxHealth = this.health;
                this.damage = isPoison ? 30 : 29;
                this.lastHitTime = 0;
                this.hitInterval = 1000;
                this.isPoison = isPoison;
                this.poisonDamage = 5;
                this.poisonDuration = 5000;
                this.slowAmount = 0.25;
                this.lastShotTime = 0;
                this.shotInterval = 2000;
            }
            
            update() {
                if (gamePaused) return;
                
                // Monstros venenosos atiram de longe
                if (this.isPoison) {
                    const now = Date.now();
                    if (now - this.lastShotTime > this.shotInterval) {
                        this.lastShotTime = now;
                        
                        const target = this.team === 'red' ? player2 : player1;
                        const angle = Math.atan2(target.y - this.y, target.x - this.x);
                        
                        const poisonBall = new Bullet(
                            this.x,
                            this.y,
                            angle,
                            5,
                            8,
                            '#0f0',
                            this.damage,
                            this.team,
                            'poison',
                            { damage: this.poisonDamage, duration: this.poisonDuration, slow: this.slowAmount }
                        );
                        projectiles.push(poisonBall);
                    }
                }
                
                // Encontrar alvo (jogador inimigo ou monstros do time oposto)
                let target = this.team === 'red' ? player2 : player1;
                let targetDistance = Math.sqrt(Math.pow(this.x - target.x, 2) + Math.pow(this.y - target.y, 2));
                
                // Verificar se h√° monstros do time oposto mais pr√≥ximos
                for (const monster of monsters) {
                    if (monster.team !== this.team) {
                        const distance = Math.sqrt(Math.pow(this.x - monster.x, 2) + Math.pow(this.y - monster.y, 2));
                        if (distance < targetDistance) {
                            target = monster;
                            targetDistance = distance;
                        }
                    }
                }
                
                // Mover em dire√ß√£o ao alvo (se n√£o for venenoso ou se estiver perto)
                if (!this.isPoison || targetDistance < 200) {
                    const angle = Math.atan2(target.y - this.y, target.x - this.x);
                    this.x += Math.cos(angle) * this.speed;
                    this.y += Math.sin(angle) * this.speed;
                }
                
                // Verificar colis√£o com o alvo (se n√£o for venenoso)
                if (!this.isPoison) {
                    const distance = Math.sqrt(Math.pow(this.x - target.x, 2) + Math.pow(this.y - target.y, 2));
                    if (distance < this.size + target.size) {
                        const now = Date.now();
                        if (now - this.lastHitTime > this.hitInterval) {
                            target.takeDamage(this.damage);
                            this.lastHitTime = now;
                        }
                    }
                }
            }
            
            draw() {
                // Corpo do monstro
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                
                // Olhos do monstro
                ctx.fillStyle = '#fff';
                ctx.beginPath();
                ctx.arc(this.x - 4, this.y - 2, 2, 0, Math.PI * 2);
                ctx.arc(this.x + 4, this.y - 2, 2, 0, Math.PI * 2);
                ctx.fill();
                
                // Boca do monstro
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.arc(this.x, this.y + 3, 3, 0.1 * Math.PI, 0.9 * Math.PI);
                ctx.stroke();
                
                // Barra de vida
                const barWidth = this.size * 2;
                const barHeight = 3;
                const healthPercent = this.health / this.maxHealth;
                
                ctx.fillStyle = '#333';
                ctx.fillRect(this.x - barWidth/2, this.y - this.size - 8, barWidth, barHeight);
                ctx.fillStyle = this.isPoison ? '#0f0' : '#f00';
                ctx.fillRect(this.x - barWidth/2, this.y - this.size - 8, barWidth * healthPercent, barHeight);
            }
            
            takeDamage(amount) {
                this.health -= amount;
                return this.health <= 0;
            }
        }

        class PowerUp {
            constructor(type) {
                this.type = type;
                this.size = 15;
                this.x = Math.random() * (config.width - 40) + 20;
                this.y = Math.random() * (config.height - 40) + 20;
                
                switch(type) {
                    case 'health20':
                        this.color = '#0a0';
                        this.healAmount = 20;
                        break;
                    case 'health40':
                        this.color = '#080';
                        this.healAmount = 40;
                        break;
                    case 'health80':
                        this.color = '#050';
                        this.healAmount = 80;
                        break;
                    case 'infiniteAmmo':
                        this.color = '#00f';
                        this.duration = 5000;
                        break;
                }
            }
            
            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x - this.size/2, this.y - this.size/2, this.size, this.size);
                
                // Desenhar borda
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.strokeRect(this.x - this.size/2, this.y - this.size/2, this.size, this.size);
                
                // Desenhar √≠cone
                ctx.fillStyle = '#fff';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                if (this.type.includes('health')) {
                    ctx.fillText('+', this.x, this.y - 2);
                    ctx.fillText(this.healAmount, this.x, this.y + 10);
                } else {
                    ctx.fillText('‚àû', this.x, this.y + 3);
                }
            }
            
            checkCollision(player) {
                const dx = player.x - this.x;
                const dy = player.y - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < player.size + this.size) {
                    if (this.type.includes('health')) {
                        player.heal(this.healAmount);
                    } else if (this.type === 'infiniteAmmo') {
                        player.shotInterval = 100; // Tiro muito r√°pido
                        setTimeout(() => {
                            if (player.type === 'fireMage') player.shotInterval = 700;
                            else if (player.type === 'archer') player.shotInterval = 250;
                            else if (player.type === 'knight') player.shotInterval = 550;
                            else if (player.type === 'necromancer') player.shotInterval = 650;
                            else if (player.type === 'assassin') player.shotInterval = 300;
                        }, this.duration);
                    }
                    return true;
                }
                return false;
            }
        }

        // Fun√ß√µes do jogo
        function spawnPowerUp() {
            const types = ['health20', 'health40', 'health80', 'infiniteAmmo'];
            const weights = [0.4, 0.3, 0.2, 0.1]; // Probabilidades para cada tipo
            const totalWeight = weights.reduce((a, b) => a + b, 0);
            let random = Math.random() * totalWeight;
            let typeIndex = 0;
            
            for (let i = 0; i < weights.length; i++) {
                if (random < weights[i]) {
                    typeIndex = i;
                    break;
                }
                random -= weights[i];
            }
            
            powerUps.push(new PowerUp(types[typeIndex]));
        }

        function roundOver(winningTeam) {
            gameRunning = false;
            gamePaused = true;
            roundWinnerTeam = winningTeam;
            roundEndTime = Date.now() + 2000; // 2 segundos
            
            // Atualizar placar
            score[winningTeam]++;
            updateScoreDisplay();
            
            // Mostrar mensagem do round
            roundWinner.textContent = winningTeam === 'red' ? 'Ponto Time Vermelho' : 'Ponto Time Azul';
            roundWinner.style.color = winningTeam === 'red' ? '#f00' : '#00f';
            roundWinner.style.display = 'block';
            
            // Verificar vit√≥ria
            if (score[winningTeam] >= 3) {
                setTimeout(() => {
                    gameOver(winningTeam);
                }, 2000);
            }
        }

        function gameOver(winningTeam) {
            gameRunning = false;
            victoryScreen.style.display = 'flex';
            victoryText.textContent = `Vit√≥ria Time ${winningTeam === 'red' ? 'Vermelho' : 'Azul'}!`;
            victoryText.style.color = winningTeam === 'red' ? '#f00' : '#00f';
            victoryText.style.textShadow = `0 0 20px ${winningTeam === 'red' ? '#f00' : '#00f'}`;
            
            // Efeito de confete
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.style.position = 'absolute';
                    confetti.style.width = '10px';
                    confetti.style.height = '10px';
                    confetti.style.backgroundColor = winningTeam === 'red' ? 
                        (Math.random() > 0.5 ? '#f00' : '#f80') : 
                        (Math.random() > 0.5 ? '#00f' : '#0af');
                    confetti.style.left = `${Math.random() * 100}%`;
                    confetti.style.top = '-10px';
                    confetti.style.borderRadius = '50%';
                    confetti.style.zIndex = '30';
                    document.body.appendChild(confetti);
                    
                    const angle = Math.random() * Math.PI * 2;
                    const distance = 100 + Math.random() * 200;
                    const duration = 2 + Math.random() * 3;
                    
                    confetti.animate([
                        { transform: `translate(0, 0) rotate(0deg)`, opacity: 1 },
                        { transform: `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance + window.innerHeight}px) rotate(${Math.random() * 360}deg)`, opacity: 0 }
                    ], {
                        duration: duration * 1000,
                        easing: 'cubic-bezier(0.1, 0.8, 0.9, 1)'
                    });
                    
                    setTimeout(() => {
                        if (confetti.parentNode) {
                            confetti.parentNode.removeChild(confetti);
                        }
                    }, duration * 1000);
                }, i * 50);
            }
        }

        function resetGame() {
            // Remover elementos de rosto e seta dos jogadores anteriores
            if (player1) player1.destroy();
            if (player2) player2.destroy();
            
            // Posicionar jogadores em lados opostos
            player1 = new Player(player1Selected, 'red', config.width * 0.25, config.height / 2);
            player2 = new Player(player2Selected, 'blue', config.width * 0.75, config.height / 2);
            
            projectiles = [];
            monsters = [];
            effects = [];
            powerUps = [];
            lastPowerUpSpawn = 0;
            gameTime = 0;
            gameOverScreen.style.display = 'none';
            victoryScreen.style.display = 'none';
            roundWinner.style.display = 'none';
            gameRunning = true;
            gamePaused = false;
            
            // Atualizar nomes dos jogadores
            player1Info.querySelector('.player-name').textContent = 
                player1Selected === 'fireMage' ? 'Mago de Fogo' : 
                player1Selected === 'archer' ? 'Arqueiro Real' : 
                player1Selected === 'knight' ? 'Cavaleiro Negro' :
                player1Selected === 'necromancer' ? 'Necromante' :
                player1Selected === 'lancer' ? 'Lanceiro' : 'Assassino';
            
            player2Info.querySelector('.player-name').textContent = 
                player2Selected === 'fireMage' ? 'Mago de Fogo' : 
                player2Selected === 'archer' ? 'Arqueiro Real' : 
                player2Selected === 'knight' ? 'Cavaleiro Negro' :
                player2Selected === 'necromancer' ? 'Necromante' :
                player2Selected === 'lancer' ? 'Lanceiro' : 'Assassino';
        }

        function newMatch() {
            score = { red: 0, blue: 0 };
            updateScoreDisplay();
            resetGame();
        }

        function returnToMenu() {
            // Remover elementos de rosto e seta
            if (player1) player1.destroy();
            if (player2) player2.destroy();
            
            gameRunning = false;
            victoryScreen.style.display = 'none';
            gameUI.style.display = 'none';
            menu.style.display = 'flex';
            score = { red: 0, blue: 0 };
            updateScoreDisplay();
        }

        function updateScoreDisplay() {
            scoreDisplay.textContent = `Vermelho ${score.red} - ${score.blue} Azul`;
        }

        function update() {
            if (!gameRunning || gamePaused) {
                // Verificar se o round acabou e o tempo de pausa terminou
                if (roundWinnerTeam && Date.now() > roundEndTime) {
                    roundWinnerTeam = null;
                    gamePaused = false;
                    gameRunning = true;
                    resetGame();
                }
                return;
            }
            
            const now = Date.now();
            gameTime = now;
            
            // Atualizar jogadores
            player1.update();
            player2.update();
            
            // Spawn de power-ups
            if (now - lastPowerUpSpawn > config.powerUpSpawnRate) {
                spawnPowerUp();
                lastPowerUpSpawn = now;
            }
            
            // Atualizar proj√©teis
            for (let i = projectiles.length - 1; i >= 0; i--) {
                if (projectiles[i].update()) {
                    projectiles.splice(i, 1);
                } else {
                    // Verificar colis√£o com jogadores
                    const bullet = projectiles[i];
                    const targetPlayer = bullet.team === 'red' ? player2 : player1;
                    
                    const dx = targetPlayer.x - bullet.x;
                    const dy = targetPlayer.y - bullet.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < targetPlayer.size + bullet.size) {
                        targetPlayer.takeDamage(bullet.damage);
                        
                        // Aplicar efeitos se houver
                        if (bullet.effectType === 'burn') {
                            effects.push({
                                target: targetPlayer,
                                damage: bullet.effectData.damage,
                                interval: 1000,
                                lastHitTime: now,
                                duration: bullet.effectData.duration,
                                startTime: now,
                                type: 'burn'
                            });
                        } else if (bullet.effectType === 'bleed') {
                            effects.push({
                                target: targetPlayer,
                                damage: bullet.effectData.damage,
                                interval: 1000,
                                lastHitTime: now,
                                duration: bullet.effectData.duration,
                                startTime: now,
                                type: 'bleed'
                            });
                        } else if (bullet.effectType === 'poison') {
                            effects.push({
                                target: targetPlayer,
                                damage: bullet.effectData.damage,
                                interval: 1000,
                                lastHitTime: now,
                                duration: bullet.effectData.duration,
                                startTime: now,
                                type: 'poison',
                                slow: bullet.effectData.slow
                            });
                        }
                        
                        projectiles.splice(i, 1);
                    }
                    
                    // Verificar colis√£o com monstros
                    for (let j = monsters.length - 1; j >= 0; j--) {
                        const monster = monsters[j];
                        if (monster.team !== bullet.team) {
                            const mdx = monster.x - bullet.x;
                            const mdy = monster.y - bullet.y;
                            const mDistance = Math.sqrt(mdx * mdx + mdy * mdy);
                            
                            if (mDistance < monster.size + bullet.size) {
                                if (monster.takeDamage(bullet.damage)) {
                                    monsters.splice(j, 1);
                                }
                                projectiles.splice(i, 1);
                                break;
                            }
                        }
                    }
                }
            }
            
            // Atualizar monstros
            for (let i = monsters.length - 1; i >= 0; i--) {
                monsters[i].update();
                
                // Verificar se monstro morreu
                if (monsters[i].health <= 0) {
                    monsters.splice(i, 1);
                }
            }
            
            // Atualizar power-ups
            for (let i = powerUps.length - 1; i >= 0; i--) {
                if (powerUps[i].checkCollision(player1) || powerUps[i].checkCollision(player2)) {
                    powerUps.splice(i, 1);
                }
            }
            
            // Atualizar efeitos
            for (let i = effects.length - 1; i >= 0; i--) {
                const effect = effects[i];
                
                if (now - effect.startTime > effect.duration) {
                    effects.splice(i, 1);
                    continue;
                }
                
                if (effect.type === 'burn' || effect.type === 'bleed' || effect.type === 'poison') {
                    if (now - effect.lastHitTime > effect.interval) {
                        effect.target.takeDamage(effect.damage);
                        
                        // Aplicar lentid√£o se for veneno
                        if (effect.type === 'poison' && effect.slow && !effect.target.slowed) {
                            const originalSpeed = effect.target.speed;
                            effect.target.speed *= (1 - effect.slow);
                            effect.target.slowed = true;
                            
                            setTimeout(() => {
                                effect.target.speed = originalSpeed;
                                effect.target.slowed = false;
                            }, effect.duration);
                        }
                        
                        effect.lastHitTime = now;
                    }
                } else if (effect.type === 'aura') {
                    // Aura de fogo do mago
                    effect.x = effect.team === 'red' ? player1.x : player2.x;
                    effect.y = effect.team === 'red' ? player1.y : player2.y;
                    
                    // Verificar colis√£o com jogador inimigo
                    const targetPlayer = effect.team === 'red' ? player2 : player1;
                    const distance = Math.sqrt(
                        Math.pow(targetPlayer.x - effect.x, 2) + 
                        Math.pow(targetPlayer.y - effect.y, 2)
                    );
                    
                    if (distance < effect.radius + targetPlayer.size) {
                        if (now - effect.lastHitTime > effect.interval) {
                            targetPlayer.takeDamage(effect.damage);
                            effect.lastHitTime = now;
                        }
                    }
                }
            }
            
            // Cavaleiro com especial ativo - verificar colis√£o com espada
            if (player1.type === 'knight' && player1.specialActive) {
                const swordLength = player1.size * 2;
                const swordEndX = player1.x + Math.cos(player1.swordAngle) * swordLength;
                const swordEndY = player1.y + Math.sin(player1.swordAngle) * swordLength;
                
                if (checkLineCircleCollision(
                    player1.x, player1.y, swordEndX, swordEndY,
                    player2.x, player2.y, player2.size
                )) {
                    player2.takeDamage(5);
                }
            }
            
            if (player2.type === 'knight' && player2.specialActive) {
                const swordLength = player2.size * 2;
                const swordEndX = player2.x + Math.cos(player2.swordAngle) * swordLength;
                const swordEndY = player2.y + Math.sin(player2.swordAngle) * swordLength;
                
                if (checkLineCircleCollision(
                    player2.x, player2.y, swordEndX, swordEndY,
                    player1.x, player1.y, player1.size
                )) {
                    player1.takeDamage(5);
                }
            }
            
            // Lanceiro atacando
            if (player1.type === 'lancer' && player1.attacking) {
                const lanceLength = player1.size * 1.5;
                const lanceEndX = player1.x + Math.cos(player1.swordAngle) * lanceLength;
                const lanceEndY = player1.y + Math.sin(player1.swordAngle) * lanceLength;
                
                if (checkLineCircleCollision(
                    player1.x, player1.y, lanceEndX, lanceEndY,
                    player2.x, player2.y, player2.size
                )) {
                    player2.takeDamage(player1.damage);
                    player1.attacking = false;
                }
            }
            
            if (player2.type === 'lancer' && player2.attacking) {
                const lanceLength = player2.size * 1.5;
                const lanceEndX = player2.x + Math.cos(player2.swordAngle) * lanceLength;
                const lanceEndY = player2.y + Math.sin(player2.swordAngle) * lanceLength;
                
                if (checkLineCircleCollision(
                    player2.x, player2.y, lanceEndX, lanceEndY,
                    player1.x, player1.y, player1.size
                )) {
                    player1.takeDamage(player2.damage);
                    player2.attacking = false;
                }
            }
        }

        function checkLineCircleCollision(x1, y1, x2, y2, cx, cy, r) {
            // Verificar se o ponto mais pr√≥ximo da linha est√° dentro do c√≠rculo
            const lineLength = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
            const u = ((cx - x1) * (x2 - x1) + (cy - y1) * (y2 - y1)) / (lineLength ** 2);
            
            if (u < 0 || u > 1) {
                // O ponto mais pr√≥ximo est√° fora do segmento de linha
                const dist1 = Math.sqrt((cx - x1) ** 2 + (cy - y1) ** 2);
                const dist2 = Math.sqrt((cx - x2) ** 2 + (cy - y2) ** 2);
                return Math.min(dist1, dist2) <= r;
            } else {
                const px = x1 + u * (x2 - x1);
                const py = y1 + u * (y2 - y1);
                const dist = Math.sqrt((cx - px) ** 2 + (cy - py) ** 2);
                return dist <= r;
            }
        }

        function draw() {
            if (!gameRunning) return;
            
            // Limpar tela
            ctx.fillStyle = '#111';
            ctx.fillRect(0, 0, config.width, config.height);
            
            // Desenhar borda vermelha (ring)
            const borderSize = 10;
            ctx.strokeStyle = '#f00';
            ctx.lineWidth = borderSize;
            ctx.strokeRect(borderSize/2, borderSize/2, config.width - borderSize, config.height - borderSize);
            
            // Desenhar divis√£o da arena
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(config.width / 2, 0);
            ctx.lineTo(config.width / 2, config.height);
            ctx.stroke();
            
            // Desenhar power-ups
            for (const powerUp of powerUps) {
                powerUp.draw();
            }
            
            // Desenhar monstros
            for (const monster of monsters) {
                monster.draw();
            }
            
            // Desenhar proj√©teis
            for (const bullet of projectiles) {
                bullet.draw();
            }
            
            // Desenhar jogadores
            player1.draw();
            player2.draw();
            
            // Desenhar efeitos
            for (const effect of effects) {
                if (effect.type === 'aura') {
                    ctx.strokeStyle = effect.team === 'red' ? 'rgba(255, 100, 0, 0.3)' : 'rgba(0, 100, 255, 0.3)';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(effect.x, effect.y, effect.radius, 0, Math.PI * 2);
                    ctx.stroke();
                } else if (effect.type === 'shadow') {
                    const alpha = effect.alpha * (1 - (Date.now() - effect.startTime) / effect.duration);
                    ctx.globalAlpha = alpha;
                    ctx.fillStyle = effect.color;
                    ctx.beginPath();
                    ctx.arc(effect.x, effect.y, effect.radius, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.globalAlpha = 1.0;
                } else if (effect.type === 'fireSpecial') {
                    // Efeito especial do mago de fogo
                    const progress = (Date.now() - effect.startTime) / effect.duration;
                    const alpha = 0.7 * (1 - progress);
                    const radius = effect.radius * (1 + progress * 0.5);
                    
                    ctx.globalAlpha = alpha;
                    ctx.fillStyle = effect.team === 'red' ? 'rgba(255, 100, 0, 0.3)' : 'rgba(0, 100, 255, 0.3)';
                    ctx.beginPath();
                    ctx.arc(effect.x, effect.y, radius, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.globalAlpha = 1.0;
                } else if (effect.type === 'swordSpecial') {
                    // Efeito especial do cavaleiro
                    const progress = (Date.now() - effect.startTime) / effect.duration;
                    const alpha = 0.7 * (1 - progress);
                    const length = config.playerSize * 3;
                    const endX = effect.x + Math.cos(effect.angle) * length;
                    const endY = effect.y + Math.sin(effect.angle) * length;
                    
                    ctx.globalAlpha = alpha;
                    ctx.strokeStyle = '#800080';
                    ctx.lineWidth = 8;
                    ctx.beginPath();
                    ctx.moveTo(effect.x, effect.y);
                    ctx.lineTo(endX, endY);
                    ctx.stroke();
                    ctx.globalAlpha = 1.0;
                } else if (effect.type === 'necromancerSpecial') {
                    // Efeito especial do necromante
                    const progress = (Date.now() - effect.startTime) / effect.duration;
                    const alpha = 0.7 * (1 - progress);
                    const radius = effect.radius * (1 + progress * 0.5);
                    
                    ctx.globalAlpha = alpha;
                    ctx.fillStyle = 'rgba(128, 0, 128, 0.3)';
                    ctx.beginPath();
                    ctx.arc(effect.x, effect.y, radius, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.globalAlpha = 1.0;
                } else if (effect.type === 'lancerSpecial') {
                    // Efeito especial do lanceiro
                    const progress = (Date.now() - effect.startTime) / effect.duration;
                    const alpha = 0.7 * (1 - progress);
                    const length = config.playerSize * 4;
                    const endX = effect.x + Math.cos(effect.angle) * length;
                    const endY = effect.y + Math.sin(effect.angle) * length;
                    
                    ctx.globalAlpha = alpha;
                    ctx.strokeStyle = effect.team === 'red' ? 'rgba(255, 100, 0, 0.5)' : 'rgba(0, 100, 255, 0.5)';
                    ctx.lineWidth = 5;
                    ctx.beginPath();
                    ctx.moveTo(effect.x, effect.y);
                    ctx.lineTo(endX, endY);
                    ctx.stroke();
                    ctx.globalAlpha = 1.0;
                } else if (effect.type === 'assassinSpecial') {
                    // Efeito especial do assassino
                    const progress = (Date.now() - effect.startTime) / effect.duration;
                    const alpha = 0.7 * (1 - progress);
                    const radius = config.playerSize * 2;
                    
                    ctx.globalAlpha = alpha;
                    ctx.strokeStyle = effect.team === 'red' ? 'rgba(255, 100, 0, 0.5)' : 'rgba(0, 100, 255, 0.5)';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(effect.x, effect.y, radius, 0, Math.PI * 2);
                    ctx.stroke();
                    ctx.globalAlpha = 1.0;
                }
            }
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // Event listeners
        window.addEventListener('resize', resizeCanvas);
        
        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            
            // Teclas do jogador 1
            if (e.key === 't' && gameRunning && !gamePaused) {
                player1.shoot();
            }
            if (e.key === 'y' && gameRunning && !gamePaused) {
                player1.useSpecial();
            }
            if (e.key === 'g' && gameRunning && !gamePaused && player1.type === 'lancer') {
                player1.attack();
            }
            
            // Teclas do jogador 2
            if (e.key === 'l' && gameRunning && !gamePaused) {
                if (player2.type === 'lancer') {
                    player2.attack();
                } else {
                    player2.shoot();
                }
            }
            if (e.key === '√ß' && gameRunning && !gamePaused) {
                player2.useSpecial();
            }
        });
        
        window.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });
        
        startButton.addEventListener('click', () => {
            if (!player1Selected || !player2Selected) {
                alert('Ambos os jogadores devem selecionar um campe√£o!');
                return;
            }
            
            menu.style.display = 'none';
            gameUI.style.display = 'block';
            newMatch();
        });
        
        restartButton.addEventListener('click', () => {
            gameOverScreen.style.display = 'none';
            newMatch();
        });
        
        rematchButton.addEventListener('click', () => {
            victoryScreen.style.display = 'none';
            newMatch();
        });
        
        menuButton.addEventListener('click', () => {
            returnToMenu();
        });
        
        characterElements.forEach(el => {
            el.addEventListener('click', () => {
                const team = el.closest('.team').classList.contains('team-red') ? 'red' : 'blue';
                const character = el.dataset.character;
                
                if (team === 'red') {
                    // Deselecionar personagem anterior do time vermelho
                    document.querySelectorAll('.team-red .character').forEach(c => 
                        c.classList.remove('selected'));
                    player1Selected = character;
                } else {
                    // Deselecionar personagem anterior do time azul
                    document.querySelectorAll('.team-blue .character').forEach(c => 
                        c.classList.remove('selected'));
                    player2Selected = character;
                }
                
                el.classList.add('selected');
            });
        });

        // Inicializa√ß√£o
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            config.width = canvas.width;
            config.height = canvas.height;
        }

        resizeCanvas();
        gameUI.style.display = 'none';
        gameOverScreen.style.display = 'none';
        victoryScreen.style.display = 'none';
        roundWinner.style.display = 'none';
        gameLoop();
    </script>
</body>
</html>
